function inscore_dropEvent(t){inscore_dragOverEvent(t);var e=new dropLoader(t.target);e.processLoader(t)}function inscore_dragOverEvent(t){t.stopPropagation(),t.preventDefault()}function inscore_resizeDocument(){INScore.postMessage("/ITL/*",["redraw"])}var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},MsgParamRetVal=function(){function t(t,e){this.correct=t,this.value=e}return t}(),IMessage=function(){function t(t,e){"string"==typeof t&&(this.fAddress=t,e?"string"==typeof e?this.fArguments=new Array(e):this.fArguments=e:this.fArguments=new Array),"object"==typeof t&&(this.fAddress=t.fAddress,this.fArguments=t.fArguments)}return t.prototype.add=function(t){this.fArguments.push(t)},t.prototype.push=function(t){if(Array.isArray(t))for(var e=0;e<t.length;e++)this.add(t[e]);else this.fArguments.push(t)},t.prototype.address=function(){return this.fAddress},t.prototype.param=function(t){return this.fArguments[t]},t.prototype.params=function(){return this.fArguments},t.prototype.paramStr=function(t){return new MsgParamRetVal(this.isType(t,"string"),this.fArguments[t])},t.prototype.paramNum=function(t){return new MsgParamRetVal(this.isType(t,"number"),this.fArguments[t])},t.prototype.paramArray=function(t){return new MsgParamRetVal(this.isType(t,"object"),this.fArguments[t])},t.prototype.message=function(){return this.paramStr(0)},t.prototype.isType=function(t,e){return typeof this.fArguments[t]===e},t.prototype.isString=function(t){return this.isType(t,"string")},t.prototype.isNumber=function(t){return this.isType(t,"number")},t.prototype.isArray=function(t){return this.isType(t,"object")},t.prototype.size=function(){return this.fArguments.length},t.prototype.toString=function(){for(var t=this.fAddress,e=0;e<this.fArguments.length;e++)t+=this.isType(e,"object")?" ( "+this.fArguments[e].toString()+" )":" "+this.fArguments[e].toString();return t},t}(),IMessageList=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(Array),kEllipseType="ellipse",kArcType="arc",kRectType="rect",kCurveType="curve",kLineType="line",kGuidoCodeType="gmn",kGuidoPianoRollType="pianoroll",kSceneType="scene",kPolygonType="polygon",kTextType="txt",kTextfType="txtf",kHtmlType="html",kImgType="img",kVideoType="video",kSvgType="svg",kSvgfType="svgf",kSyncType="sync",kWebSocketType="websocket",kDebugType="debug",kObjType="obj",kApplType="IAppl",kInscoreFile="inscore",kDefaultRate=10,kObjectSize=2,gCreateView=!0,gINScoreRealRate=kDefaultRate,eMsgStatus;!function(t){t[t.kBadAddress=0]="kBadAddress",t[t.kProcessed=1]="kProcessed",t[t.kProcessedNoChange=2]="kProcessedNoChange",t[t.kBadParameters=4]="kBadParameters",t[t.kCreateFailure=8]="kCreateFailure"}(eMsgStatus||(eMsgStatus={}));var eObjState;!function(t){t[t.kClean=0]="kClean",t[t.kNewObject=1]="kNewObject",t[t.kModified=2]="kModified",t[t.kSubModified=4]="kSubModified",t[t.kMasterModified=8]="kMasterModified"}(eObjState||(eObjState={}));var ePenStyle;!function(t){t[t.kSolid=0]="kSolid",t[t.kDash=1]="kDash",t[t.kDot=2]="kDot",t[t.kDashDot=3]="kDashDot",t[t.kDashDotDot=4]="kDashDotDot",t[t.kLast=5]="kLast"}(ePenStyle||(ePenStyle={}));var eBrushStyle;!function(t){t[t.kNone=0]="kNone",t[t.kSolid=1]="kSolid"}(eBrushStyle||(eBrushStyle={}));var eEffect;!function(t){t[t.kNone=0]="kNone",t[t.kBlur=1]="kBlur",t[t.kColorize=2]="kColorize",t[t.kShadow=3]="kShadow"}(eEffect||(eEffect={}));var eSyncModes;!function(t){t[t.kRelative=0]="kRelative",t[t.kAbsolute=1]="kAbsolute"}(eSyncModes||(eSyncModes={}));var eSyncPosition;!function(t){t[t.kSyncOver=0]="kSyncOver",t[t.kSyncTop=1]="kSyncTop",t[t.kSyncBottom=2]="kSyncBottom",t[t.kSyncFrame=3]="kSyncFrame"}(eSyncPosition||(eSyncPosition={}));var eSyncStretch;!function(t){t[t.kSyncDate=0]="kSyncDate",t[t.kSyncV=1]="kSyncV",t[t.kSyncH=2]="kSyncH"}(eSyncStretch||(eSyncStretch={}));var kNoPosition=268435455,eUIEvents;!function(t){t[t.kMouseDown=1]="kMouseDown",t[t.kMouseMove=2]="kMouseMove",t[t.kMouseUp=4]="kMouseUp",t[t.kMouseEnter=8]="kMouseEnter",t[t.kMouseLeave=16]="kMouseLeave",t[t.kDoubleClick=32]="kDoubleClick",t[t.kTouchBegin=64]="kTouchBegin",t[t.kTouchEnd=128]="kTouchEnd",t[t.kTouchUpdate=256]="kTouchUpdate"}(eUIEvents||(eUIEvents={}));var Fraction=function(){function t(e,n){if(e instanceof t)this.numerator=e.numerator,this.denominator=e.denominator;else if("number"==typeof e)void 0===n?this.rational2fraction(e):(this.numerator=e,this.denominator=n);else if("string"==typeof e&&void 0===n){var r=/^([0-9]+)\/([0-9]+)$/.test(e);r&&(this.numerator=parseInt(RegExp.$1),this.denominator=parseInt(RegExp.$2))}0==this.denominator&&(this.numerator=void 0,this.denominator=void 0)}return t.approximate=function(e,n){return new t(Math.floor(e*n),n).reduce()},t.prototype.rational2fraction=function(t){for(var e=1,n=0;t*e!=n;)e++,n=Math.floor(t*e);this.numerator=t*e,this.denominator=e,this.reduce()},t.prototype.toString=function(){return this.numerator+"/"+this.denominator},t.prototype.toNum=function(){return this.numerator/this.denominator},t.prototype.toArray=function(){return[this.numerator,this.denominator]},t.prototype.add=function(e){var n=new t(e),r=this.denominator*n.denominator;return n.numerator=this.numerator*n.denominator+n.numerator*this.denominator,n.denominator=r,n.reduce()},t.prototype.mul=function(e){var n=new t(e);return n.numerator=this.numerator*n.numerator,n.denominator=this.denominator*n.denominator,n.reduce()},t.prototype.div=function(e){var n=new t(e);return r=[n.denominator,n.numerator],n.numerator=r[0],n.denominator=r[1],this.mul(n);var r},t.prototype.sub=function(e){var n=new t(e);return n.numerator=-n.numerator,this.add(n)},t.prototype.inverse=function(){return new t(this.denominator,this.numerator).reduce()},t.prototype.eq=function(e){var n=new t(this.denominator,this.numerator).reduce(),r=new t(e).reduce();return n.denominator==r.denominator&&n.numerator==r.numerator},t.prototype.gt=function(t){return this.toNum()>t.toNum()},t.prototype.geq=function(t){return this.toNum()>=t.toNum()},t.prototype.lt=function(t){return this.toNum()<t.toNum()},t.prototype.leq=function(t){return this.toNum()<=t.toNum()},t.prototype.quantize=function(e,n){var r=this.denominator*e;if(!r)return new t(this);var o=Math.floor(this.numerator*n/r);return new t(e*o,n)},t.prototype.reduce=function(){var e=Math.max(this.numerator,this.denominator),n=Math.min(this.numerator,this.denominator);if(0==e||0==n)return new t(this);for(var r=e%n;0!=r;)e=n,n=r,r=e%n;return new t(this.numerator/n,this.denominator/n)},t.prototype.getDenominator=function(){return this.denominator},t.prototype.getNumerator=function(){return this.numerator},t.prototype.setDenominator=function(t){this.denominator=t},t.prototype.setNumerator=function(t){this.numerator=t},t}(),SetMsgHandler=function(){function t(t){this.fMethod=t}return t}(),GetMsgHandler=function(){function t(t){this.fMethod=t}return t}(),GetMsgsHandler=function(){function t(t){this.fMethod=t}return t}(),OSCAddress=function(){function t(){}return t.shift=function(t){var e=t.replace(/\/([^\/]+)(\/..*|$)/,"$1"),n=t.replace(/\/[^\/]*(.*)/,"$1");return{first:e,second:n}},t.last=function(t){return t.replace(/.*\//,"")},t.addressFirst=function(t){if(t[0]==this.kAddressSep){var e=t.indexOf(this.kAddressSep,1);return e==this.npos&&(e=t.length),t.substr(1,e-1)}return""},t.addressTail=function(t){if(t[0]==this.kAddressSep){var e=t.indexOf(this.kAddressSep,1);if(e!=this.npos)return t.substr(e,t.length-e)}return""},t}();OSCAddress.kAddressSep="/",OSCAddress.npos=-1;var TGetMsgHandlerNum=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.fill=function(t){return t.add(this.fMethod()),t},e}(GetMsgHandler),TGetMsgHandlerText=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.fill=function(t){return t.add(this.fMethod()),t},e}(GetMsgHandler),TGetMsgHandlerTime=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.fill=function(t){var e=this.fMethod();return t.add(e.getNumerator()),t.add(e.getDenominator()),t},e}(GetMsgHandler),TGetMsgHandlerArray=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.fill=function(t){return t.push(this.fMethod()),t},e}(GetMsgHandler),TGetMsgsHandler=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.getMsgs=function(){return this.fMethod()},e}(GetMsgsHandler),TMethodHandler=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.handle=function(t){return this.fMethod(t)},e}(SetMsgHandler),TMsgHandlerVoid=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.handle=function(t){return 1!=t.size()?eMsgStatus.kBadParameters:(this.fMethod(),eMsgStatus.kProcessed)},e}(SetMsgHandler),TMsgHandlerNum=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.handle=function(t){if(2!=t.size())return eMsgStatus.kBadParameters;var e=t.paramNum(1);return e.correct?(this.fMethod(e.value),eMsgStatus.kProcessed):eMsgStatus.kBadParameters},e}(SetMsgHandler),TMsgHandlerText=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.handle=function(t){if(2!=t.size())return eMsgStatus.kBadParameters;var e=t.paramStr(1);return e.correct?(this.fMethod(e.value),eMsgStatus.kProcessed):eMsgStatus.kBadParameters},e}(SetMsgHandler),TMsgHandlerColor=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.getrgb=function(t){if(t.size()<4)return{err:!0};var e=t.paramNum(1),n=t.paramNum(2),r=t.paramNum(3);return e.correct&&n.correct&&r.correct?{err:!1,rgb:[e.value,n.value,r.value]}:{err:!0}},e.prototype.handle=function(t){if(t.size()>5)return eMsgStatus.kBadParameters;var e=this.getrgb(t);if(e.err)return eMsgStatus.kBadParameters;if(5==t.size()){var n=t.paramNum(4);return n.correct?(e.rgb.push(n.value),this.fMethod(e.rgb),eMsgStatus.kProcessed):eMsgStatus.kBadParameters}return this.fMethod(e.rgb),eMsgStatus.kProcessed},e}(SetMsgHandler),TMsgHandlerAnyArray=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.handle=function(t){return this.fMethod(t.params())},e}(SetMsgHandler),TMsgHandlerNumArray=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.getnums=function(t){for(var e=[],n=1;n<t.size();n++){var r=t.paramNum(n);if(!r.correct)return{err:!0};e.push(r.value)}return{err:!1,numbers:e}},e.prototype.handle=function(t){var e=this.getnums(t);return e.err?eMsgStatus.kBadParameters:this.fMethod(e.numbers)},e}(SetMsgHandler),TMsgHandlerTime=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.handle=function(t){var e=t.size();if(e>3)return eMsgStatus.kBadParameters;if(3==e){var n=t.paramNum(1),r=t.paramNum(2);if(!n.correct||!r.correct)return eMsgStatus.kBadParameters;this.fMethod(new Fraction(n.value,r.value))}else if(2==e){var o=t.paramNum(1),i=t.paramStr(1);if(o.correct)this.fMethod(new Fraction(o.value));else{if(!i.correct)return eMsgStatus.kBadParameters;this.fMethod(new Fraction(i.value))}}return eMsgStatus.kProcessed},e}(SetMsgHandler),TEnv=function(){function t(t,e,n,r,o){this.fTarget=t,this.fMouse=e?e:{rel:{x:0,y:0},abs:{x:0,y:0},parent:{x:0,y:0}},this.fDate=n?n:new Fraction(0,1),this.fTimePos=r?r:new Fraction(0,1),this.fUser=o?o:[],this.fSystem=[]}return t.prototype.toString=function(){var t="Env: "+this.fTarget;return t+="\n	mouse: "+this.fMouse,t+="\n	date: "+this.fDate,t+="\n	timepos: "+this.fTimePos,t+="\n	user: "+this.fUser,t+="\n	system: "+this.fSystem},t}(),INScore,INScoreInterface=function(){function t(){}return t}(),OSCRegexp=function(){function t(e){this.fRegExp=new RegExp("^"+t.OSCRe2Re(e)+"$")}return t.OSCRe2Re=function(t){for(var e="",n=!1,r=0;r<t.length;r++)switch(t[r]){case"{":e+="(",n=!0;break;case",":e+=n?"|":",";break;case"}":e+=")",n=!1;break;case"*":e+=".*";break;case"?":e+=".";break;default:e+=t[r]}return e},t.prototype.match=function(t){return this.fRegExp.test(t)},t}(),Tools=function(){function t(){}return t.regexp=function(t){for(var e=t.length,n=0;e>n;n++){var r=t[n];if("*"==r||"?"==r||"["==r||"{"==r)return!0}return!1},t}(),ITLError=function(){function t(){}return t.write=function(t){var e="Error: "+t;console.log(e),INScore.postMessage("/ITL/log",["write",e])},t.badParameter=function(t,e){this.write("bad parameter "+e+" in "+t)},t}(),ITLOut=function(){function t(){}return t.write=function(t){console.log(t),INScore.postMessage("/ITL/log",["write",t])},t}(),TInterval=function(){function t(t,e){this.fFirst=t,this.fSecond=e}return t.prototype.toString=function(){return"["+this.fFirst+", "+this.fSecond+"["},t.prototype.set=function(t){this.fFirst=t.first(),this.fSecond=t.second()},t.prototype.first=function(){return this.fFirst},t.prototype.second=function(){return this.fSecond},t.prototype.neq=function(t){return!this.eq(t)},t.prototype.include=function(t){return this.includeLocation(t.first())&&this.includeLocation(t.second())},t}(),NumberInterval=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.eq=function(t){return this.fFirst==t.first()&&this.fSecond==t.second()},e.prototype.empty=function(){return this.fFirst==this.fSecond},e.prototype.includeLocation=function(t){return this.fFirst<=t&&this.fSecond>t},e.prototype.size=function(){return this.fSecond-this.fFirst},e.prototype.mult=function(t){this.fFirst*=t,this.fSecond*=t},e.prototype.toArray=function(){return[this.fFirst,this.fSecond]},e}(TInterval),TimeInterval=function(t){function e(e,n){return t.call(this,new Fraction(e),new Fraction(n))||this}return __extends(e,t),e.prototype.toNumInterval=function(){return new NumberInterval(this.fFirst.toNum(),this.fSecond.toNum())},e.prototype.eq=function(t){return this.fFirst.eq(t.first())&&this.fSecond.eq(t.second())},e.prototype.empty=function(){return this.fFirst.eq(this.fSecond)},e.prototype.size=function(){return this.fSecond.sub(this.fFirst)},e.prototype.includeLocation=function(t){return this.fFirst.leq(t)&&this.fSecond.gt(t)},e.prototype.toArray=function(){return this.fFirst.toArray().concat(this.fSecond.toArray())},e}(TInterval),TGraphicSegment=function(){function t(t,e){t?(this.fXInterval=t,this.fYInterval=e?e:t):(this.fXInterval=new NumberInterval(0,0),this.fYInterval=new NumberInterval(0,0))}return t.prototype.toString=function(){return"["+this.fXInterval+", "+this.fYInterval+"]"},t.prototype.first=function(){return this.fXInterval},t.prototype.second=function(){return this.fYInterval},t.prototype.size=function(){return this.fXInterval.size()*this.fYInterval.size()},t.prototype.empty=function(){return this.fXInterval.empty()||this.fYInterval.empty()},t.prototype.scale=function(t,e){this.fXInterval.mult(t),this.fYInterval.mult(e)},t.prototype.eq=function(t){return this.fXInterval.eq(t.fXInterval)&&this.fYInterval.eq(t.fYInterval)},t.prototype.neq=function(t){return!this.eq(t)},t.prototype.includeLocation=function(t){return this.fXInterval.includeLocation(t.x)&&this.fYInterval.includeLocation(t.y)},t.prototype.include=function(t){return this.fXInterval.include(t.first())&&this.fYInterval.include(t.second())},t}(),TTime2GraphicRelation=function(){function t(t,e){this.fTime=t,this.fGraph=e}return t.prototype.toString=function(){return this.fTime.toString()+" -> "+this.fGraph.toString()},t.prototype.includeTime=function(t){return this.fTime.includeLocation(t)},t.prototype.includePoint=function(t){return this.fGraph.includeLocation(t)},t}(),TTime2GraphicMap=function(){function t(){this.fRelations=[]}return t.prototype.toString=function(){var t="[\n";return this.fRelations.forEach(function(e){t+=" "+e+",\n"}),t+"]"},t.prototype.addElt=function(t){this.fRelations.push(t)},t.prototype.addElts=function(t){t.forEach(function(t){this.fRelations.push(t)})},t.prototype.forEach=function(t){this.fRelations.forEach(t)},t.prototype.clear=function(){this.fRelations=[]},t.prototype.getRelations=function(){return this.fRelations},t.prototype.time2Relation=function(t){for(var e=0;e<this.fRelations.length;e++)if(this.fRelations[e].includeTime(t))return this.fRelations[e];return null},t.prototype.point2Relation=function(t){for(var e=0;e<this.fRelations.length;e++)if(this.fRelations[e].includePoint(t))return this.fRelations[e];return null},t.prototype.date2Relation=function(t){for(var e=0;e<this.fRelations.length;e++)if(this.fRelations[e].includeTime(t))return this.fRelations[e];return null},t.prototype.pos2IObjectPos=function(t){return 2*t-1},t.prototype.interval2IObjectInterval=function(t){return new NumberInterval(this.pos2IObjectPos(t.first()),this.pos2IObjectPos(t.second()))},t.prototype.date2MapLocation=function(t){var e=this.date2Relation(t);if(e){var n=e.fTime,r=t.toNum()-n.first().toNum();if(r>=0){var o=r/(n.second().toNum()-n.first().toNum()),i=e.fGraph.first().first(),s=this.pos2IObjectPos(i+e.fGraph.first().size()*o);return{x:s,y:this.interval2IObjectInterval(e.fGraph.second())}}console.log("Unexpected offset "+r+" in TTime2GraphicMap.date2MapPoint")}return{x:kNoPosition,y:new NumberInterval(0,0)}},t.prototype.mapPoint2Date=function(t){var e=this.point2Relation(t);if(e){var n=e.fGraph.first(),r=t.x-n.first();if(r>=0){var o=r/n.size(),i=e.fTime.first().toNum(),s=e.fTime.second().toNum(),a=(s-i)*o;return Fraction.approximate(i+a,1e6)}console.log("Unexpected offset "+r+" in TTime2GraphicMap.mapPoint2Date")}return null},t.prototype.size=function(){return this.fRelations.length},t}(),VObjectView=function(){function t(){}return t.prototype.setMapScaleHandler=function(t){},t}(),IBrushStyle=function(){function t(){this.fBrush=eBrushStyle.kSolid,this.fBrushModified=!1}return t.brushStyleStr2Num=function(t){switch(t){case"solid":return{correct:!0,val:eBrushStyle.kSolid};case"none":return{correct:!0,val:eBrushStyle.kNone}}return{correct:!1,val:0}},t.brushStyleNum2Str=function(t){switch(t){case eBrushStyle.kSolid:return{correct:!0,val:"solid"};case eBrushStyle.kNone:return{correct:!0,val:"none"}}return{correct:!1,val:""}},t.prototype.cleanup=function(){this.fBrushModified=!1},t.prototype.brushModified=function(){return this.fBrushModified},t.prototype.modify=function(){this.fBrushModified=!0},t.prototype.getBrushStyle=function(){return this.fBrush},t.prototype.getBrushStyleStr=function(){return t.brushStyleNum2Str(this.fBrush).val},t.prototype.setBrushStyle=function(e){var n=t.brushStyleStr2Num(e);n.correct?(this.fBrush=n.val,this.fBrushModified=!0):ITLError.badParameter("brushStyle",e)},t}(),color;!function(t){t[t.kHue=0]="kHue",t[t.kSat=1]="kSat",t[t.kVal=2]="kVal",t[t.kRed=3]="kRed",t[t.kGreen=4]="kGreen",t[t.kBlue=5]="kBlue",t[t.kAlpha=6]="kAlpha"}(color||(color={}));var IColor=function(){function t(e){this.fA=255,e instanceof Array?(this.fRGB=e.slice(0,3),4==e.length&&(this.fA=e[3])):e instanceof t&&this.set(e),this.fHSB=new Array,this.updateHSB()}return t.prototype.cleanup=function(){this.fModified=!1},t.prototype.modify=function(){this.fModified=!0},t.prototype.modified=function(){return this.fModified},t.prototype.set=function(t){this.fRGB=t.fRGB.slice(0),this.fHSB=t.fHSB.slice(0),this.fA=t.fA,this.fModified=!0},t.prototype.getRGB=function(){return this.fRGB.concat(this.fA)},t.prototype.getHSB=function(){return this.fHSB.concat(this.fA)},t.prototype.getRGBAString=function(){return"rgba("+this.fRGB[0]+", "+this.fRGB[1]+", "+this.fRGB[2]+", "+this.fA+")"},t.prototype.getCSSRGBAString=function(){return"rgba("+this.fRGB[0]+", "+this.fRGB[1]+", "+this.fRGB[2]+", "+this.getSVGA()+")"},t.prototype.getRGBString=function(){return"rgb("+this.fRGB[0]+", "+this.fRGB[1]+", "+this.fRGB[2]+")"},t.prototype.getR=function(){return this.fRGB[0]},t.prototype.getG=function(){return this.fRGB[1]},t.prototype.getB=function(){return this.fRGB[2]},t.prototype.getH=function(){return this.fHSB[0]},t.prototype.getS=function(){return this.fHSB[1]},t.prototype.getV=function(){return this.fHSB[2]},t.prototype.getA=function(){return this.fA},t.prototype.getSVGA=function(){return this.fA/255},t.prototype.setParam=function(t,e,n,r,o){if(e>=n&&r>=e){switch(t){case color.kHue:this.fHSB[0]=e;break;case color.kSat:this.fHSB[1]=e;break;case color.kVal:this.fHSB[2]=e;break;case color.kRed:this.fRGB[0]=e;break;case color.kGreen:this.fRGB[1]=e;break;case color.kBlue:this.fRGB[2]=e;break;case color.kAlpha:this.fA=e;break;default:console.log("IColor setParam "+t+" not found")}this.fModified=!0,o?this.updateRGB():this.updateHSB()}},t.prototype.setRGB=function(t){this.fRGB=t.slice(0,3),4==t.length&&(this.fA=t[3]),this.updateHSB(),this.fModified=!0},t.prototype.setHSB=function(t){this.fHSB=t.slice(0,3),4==t.length&&(this.fA=t[3]),this.updateRGB(),this.fModified=!0},t.prototype.setH=function(t){this.setParam(color.kHue,Math.floor(t),0,360,!0)},t.prototype.setS=function(t){this.setParam(color.kSat,Math.floor(t),0,100,!0)},t.prototype.setV=function(t){this.setParam(color.kVal,Math.floor(t),0,100,!0)},t.prototype.setR=function(t){this.setParam(color.kRed,Math.floor(t),0,255,!1)},t.prototype.setG=function(t){this.setParam(color.kGreen,Math.floor(t),0,255,!1)},t.prototype.setB=function(t){this.setParam(color.kBlue,Math.floor(t),0,255,!1)},t.prototype.setA=function(t){this.setParam(color.kAlpha,Math.floor(t),0,255,!1)},t.prototype.dA=function(t){this.setA(this.getA()+Math.floor(t))},t.prototype.dR=function(t){this.setR(this.getR()+Math.floor(t))},t.prototype.dG=function(t){this.setG(this.getG()+Math.floor(t))},t.prototype.dB=function(t){this.setB(this.getB()+Math.floor(t))},t.prototype.dH=function(t){this.setH(this.getH()+Math.floor(t))},t.prototype.dS=function(t){this.setS(this.getS()+Math.floor(t))},t.prototype.dV=function(t){this.setB(this.getB()+Math.floor(t))},t.prototype.updateRGB=function(){this.hsb2rgb()},t.prototype.updateHSB=function(){this.rgb2hsb()},t.prototype.hsb2rgb=function(){var t,e,n,r,o,i=this.fHSB[0]/360,s=this.fHSB[1]/100,a=this.fHSB[2]/100;if(0==s)a=Math.floor(a),this.fRGB[0]=a,this.fRGB[1]=a,this.fRGB[2]=a;else{switch(i>=1?i=0:i*=6,o=Math.floor(i),t=i-o,e=a*(1-s),n=a*(1-s*t),r=a*(1-s*(1-t)),o){case 0:this.fRGB[0]=a,this.fRGB[1]=r,this.fRGB[2]=e;break;case 1:this.fRGB[1]=a,this.fRGB[0]=n,this.fRGB[2]=e;break;case 2:this.fRGB[0]=e,this.fRGB[1]=a,this.fRGB[2]=r;break;case 3:this.fRGB[0]=e,this.fRGB[1]=n,this.fRGB[2]=a;break;case 4:this.fRGB[0]=r,this.fRGB[1]=e,this.fRGB[2]=a;break;case 5:this.fRGB[0]=a,this.fRGB[1]=e,this.fRGB[2]=n}this.fRGB[0]=Math.floor(255*this.fRGB[0]),this.fRGB[1]=Math.floor(255*this.fRGB[1]),this.fRGB[2]=Math.floor(255*this.fRGB[2])}},t.prototype.rgb2hsb=function(){var t=this.fRGB[0]/255,e=this.fRGB[1]/255,n=this.fRGB[2]/255,r=Math.max(t,e,n),o=Math.min(t,e,n),i=r-o,s=0,a=0,u=r;if(0==i)s=0,a=0;else{a=i/r;var f=60*(r-t)/i+180,h=60*(r-e)/i+180,c=60*(r-n)/i+180;s=t==r?c-h:e==r?120+f-c:240+h-f}0>s&&(s+=360),s>=360&&(s-=360),this.fHSB[0]=Math.floor(s),this.fHSB[1]=Math.floor(100*a),this.fHSB[2]=Math.floor(100*u)},t}(),IDate=function(){function t(){this.fDate=new Fraction(0,1),this.fDuration=new Fraction(1,1),this.fModified=!0,this.fTempo=0}return t.prototype.modify=function(){this.fModified=!0},t.prototype.set=function(t){this.setDate(t.fDate),this.setDuration(t.fDuration),this.setTempo(t.fTempo)},t.prototype.getDate=function(){return this.fDate},t.prototype.getDuration=function(){return this.fDuration},t.prototype.getTempo=function(){return this.fTempo},t.prototype.setDate=function(t){0!=t.getDenominator()&&this.fDate!=t&&(this.fDate=t,this.modify())},t.prototype.setDuration=function(t){0!=t.getDenominator()&&this.fDuration!=t&&(this.fDuration=t,this.modify())},t.prototype.setTempo=function(t){this.fTempo=t,this.modify()},t.prototype.addDate=function(t){this.setDate(this.fDate.add(t))},t.prototype.addDuration=function(t){this.setDuration(this.fDuration.add(t))},t.prototype.addTempo=function(t){this.setTempo(this.fTempo+t)},t.prototype.modified=function(){return this.fModified},t.prototype.cleanup=function(){this.fModified=!1},t.prototype.clockDur=function(){return new Fraction(1,96)},t.prototype.clock=function(){this.addDate(this.clockDur())},t.prototype.durclock=function(){this.addDuration(this.clockDur())},t}(),IEffect=function(){function t(){this.fEffectModified=!1,this.fEffectType=eEffect.kNone,this.fEffectParams=[],t.buildEffect()}return t.buildEffect=function(){t.fEffectStr2Num.none=eEffect.kNone,t.fEffectStr2Num.blur=eEffect.kBlur,t.fEffectStr2Num.colorize=eEffect.kColorize,t.fEffectStr2Num.shadow=eEffect.kShadow,t.fEffectNum2Str[eEffect.kNone]="none",t.fEffectNum2Str[eEffect.kBlur]="blur",t.fEffectNum2Str[eEffect.kColorize]="colorize",t.fEffectNum2Str[eEffect.kShadow]="shadow",t.fEffectParamsNum[eEffect.kNone]=0,t.fEffectParamsNum[eEffect.kBlur]=1,t.fEffectParamsNum[eEffect.kColorize]=4,t.fEffectParamsNum[eEffect.kShadow]=7},t.effectStr2Num=function(e){var n=t.fEffectStr2Num[e];return{correct:"undefined"!=typeof n,val:n}},t.effectNum2Str=function(e){var n=t.fEffectNum2Str[e];return{correct:"undefined"!=typeof n,val:n}},t.prototype.type=function(){return this.fEffectType},t.prototype.params=function(){return this.fEffectParams},t.prototype.param=function(t){return this.fEffectParams[t]},t.prototype.cleanup=function(){this.fEffectModified=!1},t.prototype.effectModified=function(){return this.fEffectModified},t.prototype.modify=function(){this.fEffectModified=!0},t.prototype.getEffect=function(){var e=new Array;return e[0]=t.fEffectNum2Str[this.fEffectType],e.concat(this.fEffectParams)},t.prototype.isNumberArray=function(t){for(var e=0;e<t.length;e++)if("number"!=typeof t[e])return!1;return!0},t.prototype.assignParams=function(e,n){return this.isNumberArray(n)?n.length!=t.fEffectParamsNum[e]?eMsgStatus.kBadParameters:(this.fEffectType=e,this.fEffectParams=n,this.modify(),eMsgStatus.kProcessed):eMsgStatus.kBadParameters},t.prototype.setEffect=function(e){var n=t.effectStr2Num(e[1]);return n.correct?this.assignParams(n.val,e.slice(2)):eMsgStatus.kBadParameters},t}();IEffect.fEffectStr2Num={},IEffect.fEffectNum2Str={},IEffect.fEffectParamsNum=[];var kabsolutexy_GetSetMethod="absolutexy",kaccept_GetSetMethod="accept",kalias_GetSetMethod="alias",kalpha_GetSetMethod="alpha",kanimate_GetSetMethod="animate",kanimated_GetMethod="animated",kangle_GetSetMethod="angle",karrows_GetSetMethod="arrows",kautoScale_SetMethod="autoscale",kautoVoicesColoration_GetSetMethod="autoVoicesColoration",kblue_GetSetMethod="blue",kbrightness_GetSetMethod="brightness",kbrowse_SetMethod="browse",kcancel_SetMethod="cancel",kcliptime_GetSetMethod="clipTime",kclippitch_GetSetMethod="clipPitch",kclock_SetMethod="clock",kclose_GetSetMethod="close",kcolor_GetSetMethod="color",kcolumns_GetSetMethod="columns",kcompatibility_GetSetMethod="compatibility",kcount_GetMethod="count",kconnect_GetSetMethod="connect",kdalpha_SetMethod="dalpha",kdangle_SetMethod="dangle",kdate_GetSetMethod="date",kdblue_SetMethod="dblue",kdbrightness_SetMethod="dbrightness",kdcolor_SetMethod="dcolor",kddate_SetMethod="ddate",kdduration_SetMethod="dduration",kdebug_GetSetMethod="debug",kdefault_GetSetMethod="default",kdefaultShow_GetSetMethod="defaultShow",kdel_SetMethod="del",kdgreen_SetMethod="dgreen",kdhsb_SetMethod="dhsb",kdhue_SetMethod="dhue",kdimension_GetMethod="dimension",kdisconnect_SetMethod="disconnect",kdpage_SetMethod="dpage",kdred_SetMethod="dred",kdrange_SetMethod="drange",kdrotatex_SetMethod="drotatex",kdrotatey_SetMethod="drotatey",kdrotatez_SetMethod="drotatez",kdsaturation_SetMethod="dsaturation",kdscale_SetMethod="dscale",kdstart_SetMethod="dstart",kdtempo_SetMethod="dtempo",kdurClock_SetMethod="durClock",kduration_GetSetMethod="duration",kdx_SetMethod="dx",kdxorigin_SetMethod="dxorigin",kdy_SetMethod="dy",kdyorigin_SetMethod="dyorigin",kdz_SetMethod="dz",kedit_SetMethod="edit",keffect_GetSetMethod="effect",kend_GetSetMethod="end",kerror_SetMethod="error",kerrport_GetSetMethod="errport",kexpression_GetMethod="expr",keval_SetMethod="eval",kevent_SetMethod="event",kexport_SetMethod="export",kexportAll_SetMethod="exportAll",kfontSize_GetSetMethod="fontSize",kfontFamily_GetSetMethod="fontFamily",kfontStyle_GetSetMethod="fontStyle",kfontWeight_GetSetMethod="fontWeight",kforeground_SetMethod="foreground",kforward_GetSetMethod="forward",kframeless_GetSetMethod="frameless",kframe_GetMethod="frame",kfullscreen_GetSetMethod="fullscreen",kget_SetMethod="get",kgreen_GetSetMethod="green",kheight_GetSetMethod="height",khello_SetMethod="hello",khsb_SetMethod="hsb",khue_GetSetMethod="hue",kin_GetMethod="in",kkeyboard_GetSetMethod="keyboard",klevel_GetSetMethod="level",kload_SetMethod="load",klock_GetSetMethod="lock",kmap_GetSetMethod="map",kmapplus_SetMethod="map+",kmapf_SetMethod="mapf",kmeasureBars_GetSetMethod="measureBars",kmls_GetMethod="mls",kmouse_SetMethod="mouse",kname_GetSetMethod="name",knew_SetMethod="new",korder_GetSetMethod="order",kosc_GetSetMethod="osc",kout_GetMethod="out",koutport_GetSetMethod="outport",kpage_GetSetMethod="page",kpageCount_GetMethod="pageCount",kpitchLines_GetSetMethod="pitchLines",kpath_GetSetMethod="path",ksystemCount_GetMethod="systemCount",kpageFormat_GetSetMethod="pageFormat",kpenAlpha_GetSetMethod="penAlpha",kpenColor_GetSetMethod="penColor",kpenStyle_GetSetMethod="penStyle",kpenWidth_GetSetMethod="penWidth",kbrushStyle_GetSetMethod="brushStyle",kpendAlpha_SetMethod="pendAlpha",kpop_SetMethod="pop",kplay_GetSetMethod="play",kport_GetSetMethod="port",kpreprocess_SetMethod="preprocess",kpush_SetMethod="push",kquit_SetMethod="quit",kradius_GetSetMethod="radius",krange_GetSetMethod="range",krate_GetSetMethod="rate",krcount_GetMethod="rcount",kred_GetSetMethod="red",kread_SetMethod="read",kreject_GetSetMethod="reject",krequire_SetMethod="require",kreset_SetMethod="reset",kresetBench_SetMethod="resetBench",krootPath_GetSetMethod="rootPath",krotatex_GetSetMethod="rotatex",krotatey_GetSetMethod="rotatey",krotatez_GetSetMethod="rotatez",krows_GetSetMethod="rows",krun_SetMethod="run",ksaturation_GetSetMethod="saturation",ksave_SetMethod="save",kscale_GetSetMethod="scale",kset_SetMethod="set",kshear_GetSetMethod="shear",kshow_GetSetMethod="show",ksize_GetSetMethod="size",kstack_GetMethod="stack",kstart_GetSetMethod="start",kstatus_GetMethod="status",kstartBench_SetMethod="startBench",kstopBench_SetMethod="stopBench",ksuccess_SetMethod="success",ktempo_GetSetMethod="tempo",ktime_GetSetMethod="time",kticks_GetSetMethod="ticks",kversion_GetMethod="version",kguidoVersion_GetMethod="guido-version",kmusicxmlVersion_GetMethod="musicxml-version",kvideoMap_GetSetMethod="videoMap",kvideoMapf_SetMethod="videoMapf",kvoiceColor_GetSetMethod="voiceColor",kvdate_GetSetMethod="vdate",kvduration_GetMethod="vduration",kvolume_GetSetMethod="volume",kwatch_GetSetMethod="watch",kwatchplus_SetMethod="watch+",kwidth_GetSetMethod="width",kwindowOpacity_GetSetMethod="windowOpacity",kwrap_GetSetMethod="wrap",kwriteBench_SetMethod="writeBench",kwrite_SetMethod="write",kx_GetSetMethod="x",kxborder_GetSetMethod="xborder",kxorigin_GetSetMethod="xorigin",ky_GetSetMethod="y",kyborder_GetSetMethod="yborder",kyorigin_GetSetMethod="yorigin",kz_GetSetMethod="z",klearn_SetMethod="learn",kfollow_SetMethod="follow",kstop_SetMethod="stop",klikelihoodwindow_GetSetMethod="likelihoodwindow",klikelihoodthreshold_GetSetMethod="likelihoodthreshold",ktolerance_GetSetMethod="tolerance",kclear_SetMethod="clear",kcalibrate_SetMethod="calibrate",khasZ_GetMethod="hasZ",kmax_GetSetMethod="max",kmode_GetSetMethod="mode",ksmooth_GetSetMethod="smooth",TMessageEvaluator=function(){function t(t){this.fEnv=t,this.fTargetName=this.getOSCName(t.fTarget),this.fTargetScene=this.getOSCScene(t.fTarget)}return t.prototype.eval=function(t){for(var e=new IMessageList,n=0;n<t.length;n++){var r=t[n],o=this.evalOSCAddr(r.address(),this.fEnv),i=this.evalParams(r.params(),this.fEnv),s=new IMessage(o,i);e.push(s)}return e},t.prototype.evalOSCAddr=function(t,e){
return t.replace("$self",this.fTargetName).replace("$scene",this.fTargetScene)},t.prototype.evalIndexedVar=function(t,e){if(t.match(/[^0-9]/))return null;var n=parseInt(t)-1;return n>=0&&n<e.fUser.length?e.fUser[n]:null},t.prototype.dateVar=function(t,e,n,r){var o=t.fTimePos;return n&&(o=o.add(t.fDate)),e&&(o=o.quantize(e.first,e.second)),r?o.toNum():o.toArray()},t.prototype.evalParam=function(t,e){if("string"==typeof t){var n=t;if(n.length<2||"$"!=n[0])return t;n=n.slice(1);var r=this.evalIndexedVar(n,e);if(r)return r;var o=this.getScaling(n),i=this.getScalingFunction(o),s=null!=n.match(/..*%f/);switch(n=n.replace(/[\[%].*/,"")){case"absx":return i(e.fMouse.abs.x);case"absy":return i(e.fMouse.abs.y);case"sx":return i(e.fMouse.parent.x);case"sy":return i(e.fMouse.parent.y);case"x":return i(e.fMouse.rel.x);case"y":return i(e.fMouse.rel.y);case"date":return this.dateVar(e,o,!1,s);case"rdate":return this.dateVar(e,o,!0,s)}}else if(t.address)return this.evalGetMsg(t,e);return t},t.prototype.getScaling=function(t){var e=t.replace(/.*\[/,"").replace(/\](%f)?/,"");if(e.match(/[^0-9.,-]/))return null;var n=e.split(","),r=parseFloat(n[0]),o=parseFloat(n[1]);return isNaN(r)||isNaN(o)?null:{first:r,second:o}},t.prototype.getScalingFunction=function(t){var e=function(t){return t};return t?function(e){return t.first+(e+1)/2*(t.second-t.first)}:e},t.prototype.evalGetMsg=function(t,e){var n=[],r=t.params;if(r.length>0&&r[0]===kget_SetMethod){var o=this.evalOSCAddr(t.address.osc,this.fEnv),i=INScore.getMessage(o,r.slice(1));i.forEach(function(t){var e=t.params();e.length>1&&(n=n.concat(e.slice(e[0]==kset_SetMethod?2:1)))})}return n},t.prototype.evalParams=function(t,e){for(var n=[],r=0;r<t.length;r++){var o=t[r];o instanceof Array&&n.push(o),o=this.evalParam(o,e),o instanceof Array?n=n.concat(o):n.push(o)}return n},t.prototype.getOSCName=function(t){return t.replace(/^..*\//,"")},t.prototype.getOSCScene=function(t){return t.replace(/\/[^\/]*\//,"").replace(/\/..*/,"")},t}(),TTimeEvent=function(){function t(t,e){this.fMsgs=[],this.fInterval=t,this.fMsgs=e}return t.prototype.toMessage=function(t,e){return new IMessage(t,[e])},t}(),TTimeEventsTable=function(){function t(t){if("string"==typeof t)this.fEvent=t,this.fTable=[];else{var e=t;this.fEvent=e.fEvent,this.fTable=e.fTable.slice(0)}}return t.prototype.clear=function(){this.fTable=[]},t.prototype.size=function(){return this.fTable.length},t.prototype.getIndex=function(t){for(var e=0;e<this.fTable.length;e++)if(t.eq(this.fTable[e].fInterval))return{find:!0,index:e};return{find:!1}},t.prototype.set=function(t,e){var n=this.getIndex(t),r=new TTimeEvent(t,e);n.find?this.fTable[n.index]=r:this.fTable.push(r)},t.prototype.contains=function(t){for(var e=0;e<this.fTable.length;e++)if(this.fTable[e].fInterval.includeLocation(t))return{find:!0,event:this.fTable[e]};return{find:!1}},t.prototype.toMsgs=function(t){for(var e=[],n=0;n<this.fTable.length;n++){var r=this.fTable[n];if(r&&r.fMsgs.length)for(var o=0;o<r.fMsgs.length;o++){var i=r.fMsgs[o],s=[kwatch_GetSetMethod,this.fEvent];s=s.concat(r.fInterval.toArray()),s=s.concat(["(",i.toString(),");"]),e.push(new IMessage(t,s))}}return e},t}(),InteractionState=function(){function t(t){if("undefined"==typeof t)this.fTimeEnterEvents=new TTimeEventsTable("timeEnter"),this.fTimeLeaveEvents=new TTimeEventsTable("timeLeave"),this.fDurEnterEvents=new TTimeEventsTable("durEnter"),this.fDurLeaveEvents=new TTimeEventsTable("durLeave"),this.clear();else{this.fUserEvents={},this.fInternalEvents={},this.fAttributeEvents={};for(var e in t.fUserEvents)this.fUserEvents[e]=t.fUserEvents[e];for(var e in t.fInternalEvents)this.fInternalEvents[e]=t.fInternalEvents[e];for(var e in t.fAttributeEvents)this.fAttributeEvents[e]=t.fAttributeEvents[e];this.fTimeEnterEvents=new TTimeEventsTable(t.fTimeEnterEvents),this.fTimeLeaveEvents=new TTimeEventsTable(t.fTimeLeaveEvents),this.fDurEnterEvents=new TTimeEventsTable(t.fDurEnterEvents),this.fDurLeaveEvents=new TTimeEventsTable(t.fDurLeaveEvents)}}return t.prototype.getAttributeMsgs=function(t){return this.fAttributeEvents[t]},t.prototype.getTimeEnter=function(t){return this.fTimeEnterEvents.contains(t.toNum())},t.prototype.getTimeLeave=function(t){return this.fTimeLeaveEvents.contains(t.toNum())},t.prototype.getDurEnter=function(t){return this.fDurEnterEvents.contains(t.toNum())},t.prototype.getDurLeave=function(t){return this.fDurLeaveEvents.contains(t.toNum())},t.prototype.getMouseMsgs=function(t){return this.fInternalEvents[t]},t.prototype.clear=function(){this.fUserEvents={},this.fInternalEvents={},this.fAttributeEvents={},this.fAttributeEvents.watch=null,this.fTimeEnterEvents.clear(),this.fTimeLeaveEvents.clear(),this.fDurEnterEvents.clear(),this.fDurLeaveEvents.clear()},t.prototype.event2TimeArray=function(t){return t===this.fTimeEnterEvents.fEvent?{find:!0,tbl:this.fTimeEnterEvents}:t===this.fTimeLeaveEvents.fEvent?{find:!0,tbl:this.fTimeLeaveEvents}:t===this.fDurEnterEvents.fEvent?{find:!0,tbl:this.fDurEnterEvents}:t===this.fDurLeaveEvents.fEvent?{find:!0,tbl:this.fDurLeaveEvents}:{find:!1}},t.prototype.getWatch=function(t){var e=[];return e=e.concat(this.makeMsgs(this.fInternalEvents,t)),e=e.concat(this.makeMsgs(this.fAttributeEvents,t)),e=e.concat(this.makeMsgs(this.fUserEvents,t)),e=e.concat(this.fTimeEnterEvents.toMsgs(t)),e=e.concat(this.fTimeLeaveEvents.toMsgs(t)),e=e.concat(this.fDurEnterEvents.toMsgs(t)),e=e.concat(this.fDurLeaveEvents.toMsgs(t)),e.length||e.push(new IMessage(t,[kwatch_GetSetMethod])),e},t.prototype.hasUIEvents=function(){for(var t=0,e=0;e<IEventAble.fUIEvents.length;e++){var n=this.fInternalEvents[IEventAble.fUIEvents[e]];n&&n.length&&(t|=1<<e)}return t},t.prototype.makeMsgs=function(t,e){var n=[];for(var r in t){var o=t[r];if(o){var i=[kwatch_GetSetMethod,r,"(",o.toString(),");"];n.push(new IMessage(e,i))}}return n},t}(),IEventAble=function(){function t(){this.fAttributesNames=[],this.fSpecificEvents=["newData"],this.fState=new InteractionState,this.fStatesStack=[]}return t.prototype.specifics=function(t){this.fSpecificEvents=this.fSpecificEvents.concat(t)},t.prototype.attributes=function(t){for(var e in t)this.fAttributesNames.push(e)},t.prototype.specificEvent=function(e){return t.find(this.fSpecificEvents,e)},t.prototype.attributeEvent=function(e){return t.find(this.fAttributesNames,e)},t.prototype.hasUIEvents=function(){return this.fState.hasUIEvents()},t.prototype.handleAttributeChange=function(t){var e=this.fState.getAttributeMsgs(t);e&&e.length&&this.send(e)},t.prototype.checkTimeEvent=function(t,e){if(!t.fInterval.includeLocation(e)){var n=t.fMsgs;n&&n.length&&this.send(n)}},t.prototype.handleTimeChange=function(t,e){var n=this.fState.getTimeEnter(e);n.find?this.checkTimeEvent(n.event,t.toNum()):(n=this.fState.getTimeLeave(t),n.find&&this.checkTimeEvent(n.event,e.toNum()))},t.prototype.handleDurChange=function(t,e){var n=this.fState.getDurEnter(e);n.find?this.checkTimeEvent(n.event,t.toNum()):(n=this.fState.getDurLeave(t),n.find&&this.checkTimeEvent(n.event,e.toNum()))},t.prototype.event2evStr=function(e){switch(e){case eUIEvents.kMouseDown:return t.fUIEvents[0];case eUIEvents.kMouseMove:return t.fUIEvents[1];case eUIEvents.kMouseUp:return t.fUIEvents[2];case eUIEvents.kMouseEnter:return t.fUIEvents[3];case eUIEvents.kMouseLeave:return t.fUIEvents[4];case eUIEvents.kDoubleClick:return t.fUIEvents[5];case eUIEvents.kTouchBegin:return t.fUIEvents[6];case eUIEvents.kTouchEnd:return t.fUIEvents[7];case eUIEvents.kTouchUpdate:return t.fUIEvents[8]}return""},t.prototype.handleMouseEvent=function(t,e){var n=this.event2evStr(t),r=this.fState.getMouseMsgs(n);r&&r.length&&this.evalAndSend(r,e)},t.prototype.watch=function(t){var e=t.size()-1;if(!e)return this.fState.clear(),eMsgStatus.kProcessed;var n=t.paramStr(1);if(!n.correct)return eMsgStatus.kBadParameters;if(1==e)return this.clear1Event(n.value);if(2!=e)return this.timewatch(n.value,t);var r=t.paramArray(2),o=this.event2StringArray(n.value);if(r.correct&&o.find){var i=this.msg2msgsArray(r.value);if(i.length)return o.tbl[n.value]=i,eMsgStatus.kProcessed}return eMsgStatus.kBadParameters},t.prototype.ievent=function(t,e){var n=this.event2StringArray(t);if(!n.find)return eMsgStatus.kBadParameters;var r=n.tbl[t];return r&&r.length&&this.evalAndSend(r,e),eMsgStatus.kProcessedNoChange},t.prototype.event=function(t){this.hasUIEvents();if(t.size()<2)return eMsgStatus.kBadParameters;var e=t.paramStr(1);if(!e.correct)return eMsgStatus.kBadParameters;var n,r,o=new TEnv(t.address(),n,r,r,t.params().slice(2));return this.ievent(e.value,o)},t.prototype.getWatch=function(t){return this.fState.getWatch(t)},t.prototype.push=function(){var t=new InteractionState(this.fState);this.fStatesStack.push(t)},t.prototype.pop=function(){this.fStatesStack.length&&(this.fState=this.fStatesStack.pop())},t.find=function(t,e){for(var n=0;n<t.length;n++)if(t[n]===e)return!0;return!1},t.userEvent=function(t){var e=new RegExp("^[A-Z][A-Z0-9]*$");return e.test(t)},t.uiEvent=function(e){return t.find(t.fUIEvents,e)},t.prototype.send=function(t){t.forEach(function(t){INScore.postMessage(t.address(),t.params())})},t.prototype.evalAndSend=function(t,e){var n=new TMessageEvaluator(e);t=n.eval(t),t.forEach(function(t){INScore.postMessage(t.address(),t.params())})},t.prototype.event2StringArray=function(e){return t.uiEvent(e)?{find:!0,tbl:this.fState.fInternalEvents}:t.userEvent(e)?{find:!0,tbl:this.fState.fUserEvents}:this.attributeEvent(e)?{find:!0,tbl:this.fState.fAttributeEvents}:this.attributeEvent(e)?{find:!0,tbl:this.fState.fAttributeEvents}:{find:!1}},t.prototype.msg2msgsArray=function(t){for(var e=[],n=0;n<t.length;n++){var r=t[n];e.push(new IMessage(r.address.toString(),r.params))}return e},t.prototype.clear1Event=function(t){var e=this.event2StringArray(t);if(e.find)e.tbl[t]=[];else{var n=this.fState.event2TimeArray(t);if(!n.find)return eMsgStatus.kBadParameters;n.tbl.clear()}return eMsgStatus.kProcessed},t.prototype.params2intervals=function(t){var e=t.size()-2;if(5==e){var n=t.paramNum(2),r=t.paramNum(3),o=t.paramNum(4),i=t.paramNum(5);if(n.correct&&o.correct&&r.correct&&i.correct)return{argi:6,interval:new TimeInterval(new Fraction(n.value,r.value),new Fraction(o.value,i.value))}}else if(3==e){var s=t.paramNum(2),a=t.paramNum(3),u=t.paramStr(2),f=t.paramStr(3);if(s.correct&&a.correct)return{argi:4,interval:new TimeInterval(new Fraction(s.value,1),new Fraction(a.value,1))};if(u.correct&&f.correct)return{argi:4,interval:new TimeInterval(new Fraction(u.value),new Fraction(f.value))}}return{argi:0}},t.prototype.timewatch=function(t,e){var n=this.fState.event2TimeArray(t),r=this.params2intervals(e);if(n.find&&r.argi){var o=e.paramArray(r.argi);if(o.correct){var i=this.msg2msgsArray(o.value);if(i.length)return n.tbl.set(r.interval.toNumInterval(),i),eMsgStatus.kProcessed}}return eMsgStatus.kBadParameters},t}();IEventAble.fUIEvents=["mouseDown","mouseMove","mouseUp","mouseEnter","mouseLeave","doubleClick","touchBegin","touchEnd","touchUpdate"];var IObjectFactory,IObjectFactoryInterface=function(){function t(){}return t}(),IPenControl=function(){function t(e){this.fPenWidth=0,e==kLineType&&(this.fPenWidth=1),this.fPenColor=new IColor([0,0,0,255]),this.fPenStyle=ePenStyle.kSolid,t.buildPenStyle()}return t.prototype.cleanup=function(){this.fModified=!1},t.prototype.modified=function(){return this.fModified},t.prototype.modify=function(){this.fModified=!0},t.buildPenStyle=function(){t.fPenStyleStr2Num.solid=ePenStyle.kSolid,t.fPenStyleStr2Num.dash=ePenStyle.kDash,t.fPenStyleStr2Num.dot=ePenStyle.kDot,t.fPenStyleStr2Num.dashDot=ePenStyle.kDashDot,t.fPenStyleStr2Num.dashDotDot=ePenStyle.kDashDotDot,t.fPenStyleNum2Str[ePenStyle.kSolid]="solid",t.fPenStyleNum2Str[ePenStyle.kDash]="dashed",t.fPenStyleNum2Str[ePenStyle.kDot]="dotted",t.fPenStyleNum2Str[ePenStyle.kDashDot]="dashDot",t.fPenStyleNum2Str[ePenStyle.kDashDotDot]="dashDotDot"},t.penStyleStr2Num=function(e){var n=t.fPenStyleStr2Num[e];return{correct:"undefined"!=typeof n,val:n}},t.penStyleNum2Str=function(e){var n=t.fPenStyleNum2Str[e];return{correct:"undefined"!=typeof n,val:n}},t.prototype.getPenWidth=function(){return this.fPenWidth},t.prototype.getPenColor=function(){return this.fPenColor},t.prototype.getPenStyle=function(){return t.penStyleNum2Str(this.fPenStyle).val},t.prototype.getPenStyleNum=function(){return this.fPenStyle},t.prototype.getPenAlpha=function(){return this.fPenColor.getA()},t.prototype.setPenWidth=function(t){this.fPenWidth=t,this.modify()},t.prototype.setPenColor=function(t){this.fPenColor.set(t),this.modify()},t.prototype.setPenStyle=function(e){var n=t.penStyleStr2Num(e);n.correct?(this.fPenStyle=n.val,this.modify()):ITLError.badParameter("ePenStyle",e)},t.prototype.setPenAlpha=function(t){this.fPenColor.setA(t),this.modify()},t}();IPenControl.fPenStyleStr2Num={},IPenControl.fPenStyleNum2Str={};var IPosition=function(){function t(){this.kDefaultX=0,this.kDefaultY=0,this.fXPos=this.kDefaultX,this.fYPos=this.kDefaultY,this.fXOrigin=0,this.fYOrigin=0,this.fWidth=0,this.fHeight=0,this.fZOrder=0,this.fVisible=1,this.fScale=1,this.fXAngle=0,this.fYAngle=0,this.fZAngle=0,this.fShear=[0,0],this.fModified=!0}return t.prototype.set=function(t){this.fXPos=t.fXPos,this.fYPos=t.fYPos,this.fXOrigin=t.fXOrigin,this.fYOrigin=t.fYOrigin,this.fZOrder=t.fZOrder,this.fVisible=t.fVisible,this.fScale=t.fScale,this.fXAngle=t.fXAngle,this.fYAngle=t.fYAngle,this.fZAngle=t.fZAngle,this.fShear[0]=t.fShear[0],this.fShear[1]=t.fShear[1],this.fModified=!0},t.prototype.modified=function(){return this.fModified},t.prototype.modify=function(){this.fModified=!0},t.prototype.cleanup=function(){this.fModified=!1},t.prototype.getXPos=function(){return this.fXPos},t.prototype.getYPos=function(){return this.fYPos},t.prototype.getXOrigin=function(){return this.fXOrigin},t.prototype.getYOrigin=function(){return this.fYOrigin},t.prototype.getZOrder=function(){return this.fZOrder},t.prototype.getScale=function(){return this.fScale},t.prototype.getPos=function(){return[this.fXPos,this.fYPos]},t.prototype.getShear=function(){return this.fShear},t.prototype.getRotateX=function(){return this.fXAngle},t.prototype.getRotateY=function(){return this.fYAngle},t.prototype.getRotateZ=function(){return this.fZAngle},t.prototype.getWidth=function(){return this.fWidth},t.prototype.getHeight=function(){return this.fHeight},t.prototype.getDimension=function(){return[this.fWidth,this.fHeight]},t.prototype.getVisible=function(){return this.fVisible},t.prototype.setPos=function(t){this.setXPos(t.getXPos()),this.setYPos(t.getYPos()),this.setZOrder(t.getZOrder()),this.setScale(t.getScale()),this.setRotateX(t.getRotateX()),this.setRotateY(t.getRotateY()),this.setRotateZ(t.getRotateZ()),this.setWidth(t.getWidth()),this.setHeight(t.getHeight()),this.setVisible(t.getVisible())},t.prototype.setWidth=function(t){this.fWidth=t},t.prototype.setHeight=function(t){this.fHeight=t},t.prototype.setXPos=function(t){this.fXPos=t,this.fModified=!0},t.prototype.addXPos=function(t){this.setXPos(this.fXPos+t)},t.prototype.setXOrigin=function(t){this.fXOrigin=t,this.fModified=!0},t.prototype.addXOrigin=function(t){this.setXOrigin(this.fXOrigin+t)},t.prototype.setYPos=function(t){this.fYPos=t,this.fModified=!0},t.prototype.addYPos=function(t){this.setYPos(this.fYPos+t)},t.prototype.setYOrigin=function(t){this.fYOrigin=t,this.fModified=!0},t.prototype.addYOrigin=function(t){this.setYOrigin(this.fYOrigin+t)},t.prototype.setScale=function(t){this.fScale=t,this.fModified=!0},t.prototype.multScale=function(t){this.setScale(this.fScale*t)},t.prototype.setVisible=function(t){this.fVisible=t,this.fModified=!0},t.prototype.setZOrder=function(t){this.fZOrder=t,this.fModified=!0},t.prototype.addZOrder=function(t){this.setZOrder(this.fZOrder+t)},t.prototype.addAngle=function(t){this.setRotateZ(this.fZAngle+t)},t.prototype.addXAngle=function(t){this.setRotateX(this.fXAngle+t)},t.prototype.addYAngle=function(t){this.setRotateY(this.fYAngle+t)},t.prototype.setRotateX=function(t){this.fXAngle=t,this.fModified=!0},t.prototype.setRotateY=function(t){this.fYAngle=t,this.fModified=!0},t.prototype.setRotateZ=function(t){this.fZAngle=t,this.fModified=!0},t.prototype.setShear=function(t){return 2!=t.length?eMsgStatus.kBadParameters:(this.fShear=t,this.fModified=!0,eMsgStatus.kProcessed)},t}(),IProxy,IProxyInterface=function(){function t(){}return t}(),kposition_GetSetMethod="position",TSyncInfo=function(){function t(){this.fMode=eSyncModes.kAbsolute,this.fPosition=eSyncPosition.kSyncOver,this.fStretch=eSyncStretch.kSyncDate}return t.prototype.update=function(t){this.fMode=t.fMode,this.fPosition=t.fPosition,this.fStretch=t.fStretch},t.prototype.set=function(e){for(var n=2;n<e.size();n++){var r=e.paramStr(n);if(!r.correct)return!1;switch(r.value){case t.kSyncHStr:this.fStretch=eSyncStretch.kSyncH;break;case t.kSyncVStr:this.fStretch=eSyncStretch.kSyncV;break;case t.kSyncHVStr:this.fStretch=eSyncStretch.kSyncH+eSyncStretch.kSyncV;break;case t.kSyncOverStr:this.fPosition=eSyncPosition.kSyncOver;break;case t.kSyncTopStr:this.fPosition=eSyncPosition.kSyncTop;break;case t.kSyncBottomStr:this.fPosition=eSyncPosition.kSyncBottom;break;case t.kSyncFrameStr:this.fPosition=eSyncPosition.kSyncFrame;break;case t.kSyncRelativeStr:this.fMode=eSyncModes.kRelative;break;case t.kSyncAbsoluteStr:this.fMode=eSyncModes.kAbsolute;break;default:return!1}}return!0},t.prototype.toString=function(){return t.stretch2String(this.fStretch)+" "+t.mode2String(this.fMode)+" "+t.pos2String(this.fPosition)},t.prototype.toArray=function(){var e=[];return this.fStretch!=eSyncStretch.kSyncDate&&e.push(t.stretch2String(this.fStretch)),this.fMode==eSyncModes.kRelative&&e.push(t.mode2String(this.fMode)),this.fPosition!=eSyncPosition.kSyncOver&&e.push(t.pos2String(this.fPosition)),e},t.mode2String=function(t){return t==eSyncModes.kRelative?"relative":""},t.pos2String=function(t){switch(t){case eSyncPosition.kSyncOver:return"";case eSyncPosition.kSyncTop:return"syncTop";case eSyncPosition.kSyncBottom:return"syncBottom";case eSyncPosition.kSyncFrame:return"syncFrame"}return""},t.stretch2String=function(t){var e="";return t&eSyncStretch.kSyncH&&(e+="h"),t&eSyncStretch.kSyncV&&(e+="v"),e},t}();TSyncInfo.kSyncHStr="h",TSyncInfo.kSyncVStr="v",TSyncInfo.kSyncHVStr="hv",TSyncInfo.kSyncOverStr="syncOver",TSyncInfo.kSyncTopStr="syncTop",TSyncInfo.kSyncBottomStr="syncBottom",TSyncInfo.kSyncFrameStr="syncFrame",TSyncInfo.kSyncAbsoluteStr="absolute",TSyncInfo.kSyncRelativeStr="relative";var TMsgHandler=function(){function t(){}return t}(),TGetMsgHandler=function(){function t(){}return t}(),IObject=function(){function t(t,e){this.fSubNodes=new Array,this.fName=t,this.fTypeString="obj",this.fObjectView=[],this.fDelete=!1,this.fLock=!1,this.fState=eObjState.kNewObject,this.fNewData=!0,this.fParent=e,this.fPosition=new IPosition,this.fDate=new IDate,this.fColor=new IColor([0,0,0]),this.fPenControl=new IPenControl(kObjType),this.fBrushStyle=new IBrushStyle,this.fEffect=new IEffect,this.fEvents=new IEventAble,this.fMsgHandlerMap=new TMsgHandler,this.fGetMsgHandlerMap=new TGetMsgHandler,this.fGetMsgsHandlerMap=new TGetMsgHandler,this.fMsgHandlerMap.watch=null,this.fGetMsgHandlerMap.watch=null,this.fGetMsgsHandlerMap.watch=null,this.setHandlers(),this.createStaticNodes(),this.fEvents.attributes(this.fMsgHandlerMap),this.fMapping=this.createMapping()}return t.prototype.createMapping=function(){var t=new TTime2GraphicMap,e=new TimeInterval(new Fraction(0,1),this.fDate.getDuration()),n=new TGraphicSegment(new NumberInterval(0,1),new NumberInterval(0,1));return t.addElt(new TTime2GraphicRelation(e,n)),t},t.prototype.createStaticNodes=function(){this.fDebug=IObjectFactory.createObj("debug",kDebugType,this),this.addChild(this.fDebug),this.fSync=IObjectFactory.createObj("sync",kSyncType,this),this.addChild(this.fSync)},t.prototype.setHandlers=function(){var t=this;this.fMsgHandlerMap[kset_SetMethod]=new TMethodHandler(function(e){return t.set(e)}),this.fMsgHandlerMap[kget_SetMethod]=new TMethodHandler(function(e){return t.get(e)}),this.fMsgHandlerMap[ksave_SetMethod]=new TMethodHandler(function(e){return t.save(e)}),this.fMsgHandlerMap[kdel_SetMethod]=new TMsgHandlerVoid(function(){t.del()}),this.eventAble(),this.colorAble(),this.positionAble(),this.timeAble(),this.penControlAble(),this.effectAble()},t.prototype.getColorTarget=function(){return this.fColor},t.prototype.eventAble=function(){var t=this;this.fMsgHandlerMap[kwatch_GetSetMethod]=new TMethodHandler(function(e){return t.fEvents.watch(e)}),this.fMsgHandlerMap[kevent_SetMethod]=new TMethodHandler(function(e){return t.fEvents.event(e)}),this.fMsgHandlerMap[kpush_SetMethod]=new TMsgHandlerVoid(function(){t.fEvents.push()}),this.fMsgHandlerMap[kpop_SetMethod]=new TMsgHandlerVoid(function(){t.fEvents.pop()}),this.fGetMsgsHandlerMap[kwatch_GetSetMethod]=new TGetMsgsHandler(function(){var e=t.getOSCAddress();return t.fEvents.getWatch(e)})},t.prototype.colorAble=function(){var t=this.getColorTarget();this.fMsgHandlerMap[kcolor_GetSetMethod]=new TMsgHandlerColor(function(e){t.setRGB(e)}),this.fMsgHandlerMap[khsb_SetMethod]=new TMsgHandlerColor(function(e){t.setHSB(e)}),this.fMsgHandlerMap[kred_GetSetMethod]=new TMsgHandlerNum(function(e){t.setR(e)}),this.fMsgHandlerMap[kgreen_GetSetMethod]=new TMsgHandlerNum(function(e){t.setG(e)}),this.fMsgHandlerMap[kblue_GetSetMethod]=new TMsgHandlerNum(function(e){t.setB(e)}),this.fMsgHandlerMap[kalpha_GetSetMethod]=new TMsgHandlerNum(function(e){t.setA(e)}),this.fMsgHandlerMap[khue_GetSetMethod]=new TMsgHandlerNum(function(e){t.setH(e)}),this.fMsgHandlerMap[ksaturation_GetSetMethod]=new TMsgHandlerNum(function(e){t.setS(e)}),this.fMsgHandlerMap[kbrightness_GetSetMethod]=new TMsgHandlerNum(function(e){t.setV(e)}),this.fMsgHandlerMap[kdred_SetMethod]=new TMsgHandlerNum(function(e){t.dR(e)}),this.fMsgHandlerMap[kdgreen_SetMethod]=new TMsgHandlerNum(function(e){t.dG(e)}),this.fMsgHandlerMap[kdblue_SetMethod]=new TMsgHandlerNum(function(e){t.dB(e)}),this.fMsgHandlerMap[kdalpha_SetMethod]=new TMsgHandlerNum(function(e){t.dA(e)}),this.fMsgHandlerMap[kdhue_SetMethod]=new TMsgHandlerNum(function(e){t.dH(e)}),this.fMsgHandlerMap[kdsaturation_SetMethod]=new TMsgHandlerNum(function(e){t.dS(e)}),this.fMsgHandlerMap[kdbrightness_SetMethod]=new TMsgHandlerNum(function(e){t.dV(e)}),this.fGetMsgHandlerMap[kcolor_GetSetMethod]=new TGetMsgHandlerArray(function(){return t.getRGB()}),this.fGetMsgHandlerMap[khsb_SetMethod]=new TGetMsgHandlerArray(function(){return t.getHSB()}),this.fGetMsgHandlerMap[kred_GetSetMethod]=new TGetMsgHandlerNum(function(){return t.getR()}),this.fGetMsgHandlerMap[kgreen_GetSetMethod]=new TGetMsgHandlerNum(function(){return t.getG()}),this.fGetMsgHandlerMap[kblue_GetSetMethod]=new TGetMsgHandlerNum(function(){return t.getB()}),this.fGetMsgHandlerMap[kalpha_GetSetMethod]=new TGetMsgHandlerNum(function(){return t.getA()}),this.fGetMsgHandlerMap[khue_GetSetMethod]=new TGetMsgHandlerNum(function(){return t.getH()}),this.fGetMsgHandlerMap[ksaturation_GetSetMethod]=new TGetMsgHandlerNum(function(){return t.getS()}),this.fGetMsgHandlerMap[kbrightness_GetSetMethod]=new TGetMsgHandlerNum(function(){return t.getV()})},t.prototype.positionAble=function(){var t=this;this.fMsgHandlerMap[kx_GetSetMethod]=new TMsgHandlerNum(function(e){t.fPosition.setXPos(e)}),this.fMsgHandlerMap[ky_GetSetMethod]=new TMsgHandlerNum(function(e){t.fPosition.setYPos(e)}),this.fMsgHandlerMap[kxorigin_GetSetMethod]=new TMsgHandlerNum(function(e){t.fPosition.setXOrigin(e)}),this.fMsgHandlerMap[kyorigin_GetSetMethod]=new TMsgHandlerNum(function(e){t.fPosition.setYOrigin(e)}),this.fMsgHandlerMap[kz_GetSetMethod]=new TMsgHandlerNum(function(e){t.fPosition.setZOrder(e)}),this.fMsgHandlerMap[kangle_GetSetMethod]=new TMsgHandlerNum(function(e){t.fPosition.setRotateZ(e)}),this.fMsgHandlerMap[kscale_GetSetMethod]=new TMsgHandlerNum(function(e){t.setScale(e)}),this.fMsgHandlerMap[krotatex_GetSetMethod]=new TMsgHandlerNum(function(e){t.fPosition.setRotateX(e)}),this.fMsgHandlerMap[krotatey_GetSetMethod]=new TMsgHandlerNum(function(e){t.fPosition.setRotateY(e)}),this.fMsgHandlerMap[krotatez_GetSetMethod]=new TMsgHandlerNum(function(e){t.fPosition.setRotateZ(e)}),this.fMsgHandlerMap[kshear_GetSetMethod]=new TMsgHandlerNumArray(function(e){return t.fPosition.setShear(e)}),this.fMsgHandlerMap[kdx_SetMethod]=new TMsgHandlerNum(function(e){t.fPosition.addXPos(e)}),this.fMsgHandlerMap[kdy_SetMethod]=new TMsgHandlerNum(function(e){t.fPosition.addYPos(e)}),this.fMsgHandlerMap[kdxorigin_SetMethod]=new TMsgHandlerNum(function(e){t.fPosition.addXOrigin(e)}),this.fMsgHandlerMap[kdyorigin_SetMethod]=new TMsgHandlerNum(function(e){t.fPosition.addYOrigin(e)}),this.fMsgHandlerMap[kdz_SetMethod]=new TMsgHandlerNum(function(e){t.fPosition.addZOrder(e)}),this.fMsgHandlerMap[kdangle_SetMethod]=new TMsgHandlerNum(function(e){t.fPosition.addAngle(e)}),this.fMsgHandlerMap[kdscale_SetMethod]=new TMsgHandlerNum(function(e){t.fPosition.multScale(e)}),this.fMsgHandlerMap[kdrotatex_SetMethod]=new TMsgHandlerNum(function(e){t.fPosition.addXAngle(e)}),this.fMsgHandlerMap[kdrotatey_SetMethod]=new TMsgHandlerNum(function(e){t.fPosition.addYAngle(e)}),this.fMsgHandlerMap[kdrotatez_SetMethod]=new TMsgHandlerNum(function(e){t.fPosition.addAngle(e)}),this.fMsgHandlerMap[kshow_GetSetMethod]=new TMsgHandlerNum(function(e){t.fPosition.setVisible(e)}),this.fGetMsgHandlerMap[kx_GetSetMethod]=new TGetMsgHandlerNum(function(){return t.fPosition.getXPos()}),this.fGetMsgHandlerMap[ky_GetSetMethod]=new TGetMsgHandlerNum(function(){return t.fPosition.getYPos()}),this.fGetMsgHandlerMap[kxorigin_GetSetMethod]=new TGetMsgHandlerNum(function(){return t.fPosition.getXOrigin()}),this.fGetMsgHandlerMap[kyorigin_GetSetMethod]=new TGetMsgHandlerNum(function(){return t.fPosition.getYOrigin()}),this.fGetMsgHandlerMap[kz_GetSetMethod]=new TGetMsgHandlerNum(function(){return t.fPosition.getZOrder()}),this.fGetMsgHandlerMap[kangle_GetSetMethod]=new TGetMsgHandlerNum(function(){return t.fPosition.getRotateZ()}),this.fGetMsgHandlerMap[kscale_GetSetMethod]=new TGetMsgHandlerNum(function(){return t.fPosition.getScale()}),this.fGetMsgHandlerMap[kshow_GetSetMethod]=new TGetMsgHandlerNum(function(){return t.fPosition.getVisible()}),this.fGetMsgHandlerMap[kwidth_GetSetMethod]=new TGetMsgHandlerNum(function(){return t.fPosition.getWidth()}),this.fGetMsgHandlerMap[kheight_GetSetMethod]=new TGetMsgHandlerNum(function(){return t.fPosition.getHeight()}),this.fGetMsgHandlerMap[krotatex_GetSetMethod]=new TGetMsgHandlerNum(function(){return t.fPosition.getRotateX()}),this.fGetMsgHandlerMap[krotatey_GetSetMethod]=new TGetMsgHandlerNum(function(){return t.fPosition.getRotateY()}),this.fGetMsgHandlerMap[krotatez_GetSetMethod]=new TGetMsgHandlerNum(function(){return t.fPosition.getRotateZ()}),this.fGetMsgHandlerMap[kshear_GetSetMethod]=new TGetMsgHandlerArray(function(){return t.fPosition.getShear()})},t.prototype.timeAble=function(){var t=this;this.fMsgHandlerMap[kdate_GetSetMethod]=new TMsgHandlerTime(function(e){t.setDate(e)}),this.fMsgHandlerMap[kduration_GetSetMethod]=new TMsgHandlerTime(function(e){t.setDuration(e)}),this.fMsgHandlerMap[kddate_SetMethod]=new TMsgHandlerTime(function(e){t.addDate(e)}),this.fMsgHandlerMap[kdduration_SetMethod]=new TMsgHandlerTime(function(e){t.addDuration(e)}),this.fMsgHandlerMap[kclock_SetMethod]=new TMsgHandlerVoid(function(){t.clock()}),this.fMsgHandlerMap[kdurClock_SetMethod]=new TMsgHandlerVoid(function(){t.durclock()}),this.fMsgHandlerMap[ktempo_GetSetMethod]=new TMsgHandlerNum(function(e){t.fDate.setTempo(e)}),this.fMsgHandlerMap[kdtempo_SetMethod]=new TMsgHandlerNum(function(e){t.fDate.addTempo(e)}),this.fGetMsgHandlerMap[ktempo_GetSetMethod]=new TGetMsgHandlerNum(function(){return t.fDate.getTempo()}),this.fGetMsgHandlerMap[kduration_GetSetMethod]=new TGetMsgHandlerTime(function(){return t.fDate.getDuration()}),this.fGetMsgHandlerMap[kdate_GetSetMethod]=new TGetMsgHandlerTime(function(){return t.fDate.getDate()})},t.prototype.penControlAble=function(){var t=this;this.fMsgHandlerMap[kpenWidth_GetSetMethod]=new TMsgHandlerNum(function(e){t.fPenControl.setPenWidth(e)}),this.fMsgHandlerMap[kpenColor_GetSetMethod]=new TMsgHandlerColor(function(e){t.fPenControl.setPenColor(new IColor(e))}),this.fMsgHandlerMap[kpenStyle_GetSetMethod]=new TMsgHandlerText(function(e){t.fPenControl.setPenStyle(e)}),this.fMsgHandlerMap[kpenAlpha_GetSetMethod]=new TMsgHandlerNum(function(e){t.fPenControl.setPenAlpha(e)}),this.fGetMsgHandlerMap[kpenWidth_GetSetMethod]=new TGetMsgHandlerNum(function(){return t.fPenControl.getPenWidth()}),this.fGetMsgHandlerMap[kpenColor_GetSetMethod]=new TGetMsgHandlerArray(function(){return t.fPenControl.getPenColor().getRGB()}),this.fGetMsgHandlerMap[kpenStyle_GetSetMethod]=new TGetMsgHandlerText(function(){return t.fPenControl.getPenStyle()}),this.fGetMsgHandlerMap[kpenAlpha_GetSetMethod]=new TGetMsgHandlerNum(function(){return t.fPenControl.getPenAlpha()})},t.prototype.brushAble=function(){var t=this;this.fGetMsgHandlerMap[kbrushStyle_GetSetMethod]=new TGetMsgHandlerText(function(){return t.fBrushStyle.getBrushStyleStr()}),this.fMsgHandlerMap[kbrushStyle_GetSetMethod]=new TMsgHandlerText(function(e){t.fBrushStyle.setBrushStyle(e)})},t.prototype.effectAble=function(){var t=this;this.fGetMsgHandlerMap[keffect_GetSetMethod]=new TGetMsgHandlerArray(function(){return t.fEffect.getEffect()}),this.fMsgHandlerMap[keffect_GetSetMethod]=new TMsgHandlerAnyArray(function(e){return t.fEffect.setEffect(e)})},t.prototype.setWidth=function(t){this.fPosition.setWidth(t),this.posPropagate()},t.prototype.setHeight=function(t){this.fPosition.setHeight(t),this.posPropagate()},t.prototype.setScale=function(t){this.fPosition.setScale(t),this.posPropagate()},t.prototype.subModPropagate=function(t){t&&(t.addState(eObjState.kSubModified),this.subModPropagate(t.fParent))},t.prototype.posPropagate=function(){var t=new IObjectTreeApply;t.applyPosModified(this)},t.prototype.posModified=function(){this.fPosition.modify(),this.addState(eObjState.kModified+eObjState.kSubModified)},t.prototype.allModified=function(){this.addState(eObjState.kModified),this.fPosition.modify(),this.fDate.modify(),this.fColor.modify(),this.fPenControl.modify(),this.fBrushStyle.modify(),this.fEffect.modify()},t.prototype.setDate=function(t){this.fEvents.handleTimeChange(this.fDate.getDate(),t),this.fDate.setDate(t)},t.prototype.addDate=function(t){this.setDate(this.fDate.getDate().add(t))},t.prototype.clock=function(){this.setDate(this.fDate.getDate().add(this.fDate.clockDur()))},t.prototype.setDuration=function(t){this.fEvents.handleDurChange(this.fDate.getDuration(),t),this.fDate.setDuration(t)},t.prototype.addDuration=function(t){this.setDuration(this.fDate.getDuration().add(t))},t.prototype.durclock=function(){this.setDuration(this.fDate.getDuration().add(this.fDate.clockDur()))},t.prototype.hasUIEvents=function(){return this.fEvents.hasUIEvents()},t.prototype.handleMouseEvent=function(t,e,n){var r=new TEnv(this.getOSCAddress(),e,this.fDate.getDate(),n);this.fEvents.handleMouseEvent(t,r)},t.prototype.mapPoint2Date=function(t){return this.fMapping.mapPoint2Date(t)},t.prototype.date2MapLocation=function(t){return this.fMapping.date2MapLocation(t)},t.prototype.date2FramePoint=function(t){var e=this.fDate.getDuration().toNum(),n=t.toNum();if(n>e)return{x:kNoPosition,y:0};var r=4*kObjectSize*n/e;return kObjectSize>=r?{x:r-1,y:-1}:(r-=kObjectSize,kObjectSize>=r?{x:1,y:r-1}:(r-=kObjectSize,kObjectSize>=r?{x:1-r,y:1}:(r-=kObjectSize,{x:-1,y:1-r})))},t.prototype.addChild=function(t){this.fSubNodes.push(t),this.addState(eObjState.kSubModified)},t.prototype.setParent=function(t){this.fParent=t},t.prototype.getParent=function(){return this.fParent},t.prototype.getSubNodes=function(){return this.fSubNodes},t.prototype.getSubNodesCount=function(){return this.fSubNodes.length},t.prototype.getAppl=function(){return this.fParent.getAppl()},t.prototype.getScene=function(){return this.fParent.getScene();
},t.prototype.getRScale=function(){return this.fPosition.getScale()*this.fParent.getRScale()},t.prototype.getRSizeAsScale=function(){var t=Math.min(this.fPosition.getWidth(),this.fPosition.getHeight());return t/2*this.fParent.getRSizeAsScale()},t.prototype.getPosition=function(){return{x:this.fPosition.getXPos(),y:this.fPosition.getYPos()}},t.prototype.getSize=function(){return{w:this.fPosition.getWidth(),h:this.fPosition.getHeight()}},t.prototype.getRotate=function(){return{x:this.fPosition.getRotateX(),y:this.fPosition.getRotateY(),z:this.fPosition.getRotateZ()}},t.prototype.getSlavePosition=function(t,e){if(e.fPosition==eSyncPosition.kSyncFrame){var n=this.date2FramePoint(this.fDate.getDate());return n}var r=t.date2MapLocation(this.fDate.getDate()),o=0;switch(e.fPosition){case eSyncPosition.kSyncTop:o=r.y.first();break;case eSyncPosition.kSyncBottom:o=r.y.second();break;case eSyncPosition.kSyncOver:default:o=r.y.first()+r.y.size()/2}return{x:r.x,y:o}},t.prototype.toString=function(){var t=this.fSubNodes.length,e="";return t&&(e=" ["+this.fSubNodes+"] "),this.fName+e},t.prototype.getName=function(){return this.fName},t.prototype.getTypeString=function(){return this.fTypeString},t.prototype.match=function(t){var e=new OSCRegexp(t);return e.match(this.fName)},t.prototype.find=function(t){if(!Tools.regexp(t))return this.exactfind(t);var e=new OSCRegexp(t),n=[];return this.fSubNodes.forEach(function(t){!t.getDeleted()&&e.match(t.fName)&&n.push(t)}),n},t.prototype.exactfind=function(t){var e=[];return this.fSubNodes.forEach(function(n){n.getDeleted()||n.fName!=t||e.push(n)}),e},t.prototype.newData=function(t){this.fNewData=t},t.prototype.isNewData=function(){return this.fNewData},t.prototype.setState=function(t){this.fState=t},t.prototype.addState=function(t){this.fState|=t},t.prototype.getState=function(){return this.fState},t.prototype.getPos=function(){return this.fPosition},t.prototype.getColor=function(){return this.fColor},t.prototype.getOSCAddress=function(){return this.fParent.getOSCAddress()+"/"+this.fName},t.prototype.transferAttributes=function(t){return t.fPosition.set(this.fPosition),t.fColor.set(this.fColor),t.fDate.set(this.fDate),t},t.prototype.setView=function(t){this.fObjectView=[t]},t.prototype.addView=function(t){this.fObjectView.push(t)},t.prototype.addViews=function(t){this.fObjectView=this.fObjectView.concat(t)},t.prototype.getViews=function(){return this.fObjectView},t.prototype.removeView=function(t){var e=this.fObjectView.indexOf(t);e>=0&&(t.remove(),this.fObjectView.splice(e,1))},t.prototype.removeViews=function(){this.fObjectView.forEach(function(t){t.remove()}),this.fObjectView=[]},t.prototype.execute=function(t){if(0==t.size())return eMsgStatus.kBadParameters;var e=t.message();if(e.correct){var n=this.messageHandler(e.value);if(n){var r=n.handle(t);return r&(eMsgStatus.kProcessed|eMsgStatus.kProcessedNoChange)&&this.fEvents.handleAttributeChange(e.value),r}}return eMsgStatus.kBadParameters},t.prototype.messageHandler=function(t,e){var n;return e?n:this.fMsgHandlerMap[t]},t.prototype.getTargetObjects=function(t){var e=[];return this.match(t.first)&&(t=OSCAddress.shift(t.second),t.second.length?this.fSubNodes.forEach(function(n){e=e.concat(n.getTargetObjects(t))}):e=e.concat(this.find(t.first))),e},t.prototype.process=function(t){var e=OSCAddress.shift(t.address());return this.processMsg(e.first,e.second,t)},t.prototype.processMsg=function(t,e,n){var r=eMsgStatus.kBadAddress;if(this.match(t)){var o=OSCAddress.shift(e);if(o.second.length)this.fSubNodes.forEach(function(t){r|=t.processMsg(o.first,o.second,n)});else{var i=this.find(o.first),s=i.length;s?i.forEach(function(t){r|=t.execute(n),r&eMsgStatus.kProcessed&&t.addState(eObjState.kModified)}):r=Tools.regexp(o.first)?eMsgStatus.kProcessedNoChange:this.proxy_create(n,o.first,this).status}}return r&eMsgStatus.kProcessed+eObjState.kSubModified&&this.addState(eObjState.kSubModified),r},t.prototype.set=function(t){var e=t.paramStr(1);if(!e.correct)return eMsgStatus.kBadParameters;if(e.value!=this.getTypeString()){var n=this.proxy_create(t,this.fName,this.getParent());return n.status&eMsgStatus.kProcessed?(this.transferAttributes(n.obj),this.del(),n.status):eMsgStatus.kProcessedNoChange}return eMsgStatus.kBadParameters},t.prototype.getCall=function(t){var e=[],n=t.size();if(1==n){var r=this.getSet();r&&e.push(r)}else for(var o=1;n>o;o++){var i=t.paramStr(o);i.correct?e=e.concat(this.get1AttributeMsg(i.value)):ITLError.badParameter(t.toString(),t.param(o))}return e},t.prototype.get=function(t){var e=this.getCall(t);return e.forEach(function(t){ITLOut.write(t.toString()+";")}),eMsgStatus.kProcessedNoChange},t.prototype.save=function(t){var e=this.getSetRecurse();return e.forEach(function(t){ITLOut.write(t.toString()+";")}),eMsgStatus.kProcessedNoChange},t.prototype.getSet=function(){return null},t.prototype.get1AttributeMsg=function(t){var e=this.fGetMsgHandlerMap[t];if(e){var n=new IMessage(this.getOSCAddress(),t);return e.fill(n),[n]}var r=this.fGetMsgsHandlerMap[t];return r?r.getMsgs():[]},t.prototype.getAttributesMsg=function(){var t=new IMessageList;for(var e in this.fMsgHandlerMap){var n=this.get1AttributeMsg(e);n&&(t=t.concat(n))}return t},t.prototype.getSetRecurse=function(){var t=new IMessageList,e=this.getSet();e&&t.push(e);for(var n=this.getAttributesMsg(),r=0;r<n.length;r++)t.push(n[r]);for(var o=this.getSubNodesCount(),r=0;o>r;r++)for(var i=this.fSubNodes[r].getSetRecurse(),s=0;s<i.length;s++)t.push(i[s]);return t},t.prototype.proxy_create=function(t,e,n){return IProxy.execute(t,e,n)},t.prototype.delNotify=function(t){},t.prototype.getDeleted=function(){return this.fDelete},t.prototype.del=function(){this.fDelete=!0,this.fParent.fSync.delNotify(this),this.removeViews();var t=this.fParent.getSubNodes();t.splice(t.indexOf(this),1)},t.prototype.cleanup=function(){this.fPosition.cleanup(),this.fDate.cleanup(),this.fColor.cleanup(),this.fPenControl.cleanup(),this.setState(eObjState.kClean),this.fBrushStyle.cleanup(),this.fEffect.cleanup(),this.fNewData=!1,this.fDate.getTempo()&&this.move()},t.prototype.move=function(){INScore.postMessage(this.getOSCAddress(),[kddate_SetMethod,gINScoreRealRate*this.fDate.getTempo(),24e4])},t.timeTaskCleanup=function(e){var n=e.getState();if(n&eObjState.kNewObject+eObjState.kModified&&e.cleanup(),n&eObjState.kSubModified){e.setState(eObjState.kClean);for(var r=e.getSubNodes(),o=0;o<r.length;o++)t.timeTaskCleanup(r[o])}},t}(),IObjectTreeApply=function(){function t(){}return t.prototype.apply=function(t,e){t(e);for(var n=e.getSubNodes(),r=0;r<n.length;r++)this.apply(t,n[r])},t.prototype.cleanup=function(t){t.cleanup()},t.prototype.applyCleanup=function(t){var e=this;this.apply(function(t){return e.cleanup(t)},t)},t.prototype.posModified=function(t){t.posModified()},t.prototype.applyPosModified=function(t){var e=this;this.apply(function(t){return e.posModified(t)},t)},t}(),IDebug=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.fTypeString=kDebugType,r.fShowMap=!1,r.fShowName=!1,r}return __extends(e,t),e.prototype.setHandlers=function(){var t=this;this.fMsgHandlerMap[kname_GetSetMethod]=new TMsgHandlerNum(function(e){t.setShowName(e)}),this.fMsgHandlerMap[kmap_GetSetMethod]=new TMsgHandlerNum(function(e){t.setShowMap(e)}),this.fMsgHandlerMap[kget_SetMethod]=new TMethodHandler(function(e){return t.get(e)}),this.fGetMsgHandlerMap[kname_GetSetMethod]=new TGetMsgHandlerNum(function(){return t.getShowName()}),this.fGetMsgHandlerMap[kmap_GetSetMethod]=new TGetMsgHandlerNum(function(){return t.getShowMap()})},e.prototype.getShowMap=function(){return this.fShowMap?1:0},e.prototype.getShowName=function(){return this.fShowName?1:0},e.prototype.setShowMap=function(t){this.fShowMap=t?!0:!1,this.fParent.addState(eObjState.kModified)},e.prototype.setShowName=function(t){this.fShowName=t?!0:!1,this.fParent.addState(eObjState.kModified)},e.prototype.createStaticNodes=function(){},e}(IObject),VHtmlView=function(t){function e(e,n){var r=t.call(this)||this;return r.fDisplayMap=!1,r.fDisplayName=!1,r.fParent=n,r.setPos(0,0,100,100),r.fHtmlElt=e,r.fTranslateX=r.fTranslateY=0,r.fPositionHandler=null,n&&n.getHtml().appendChild(e),r.setDefaultPositionStyle(),r}return __extends(e,t),e.prototype.setPositionHandler=function(t){this.fPositionHandler=t},e.prototype.setDefaultPositionStyle=function(){this.fHtmlElt.style.position="absolute"},e.prototype.getParent=function(){return this.fParent},e.prototype.getHtml=function(){return this.fHtmlElt},e.prototype.remove=function(){this.fHtmlElt.parentNode.removeChild(this.fHtmlElt)},e.prototype.updateView=function(t){this.updatePos(t),this.updateColor(t),this.updatePenControl(t),this.updateEffects(t),this.updateEvents(t);var e=t.fDebug;e.fShowName?this.showName(t):this.fDisplayName&&this.removeName(),e.fShowMap?this.showMap(t):this.fDisplayMap&&this.removeMap()},e.prototype.showName=function(t){var e=document.createElement("div");e.className="inscore-debug",e.id="_name_",e.innerHTML=t.getName(),this.getHtml().appendChild(e),this.fDisplayName=!0},e.prototype.removeName=function(){var t=this.getHtml().querySelectorAll("#_name_");t&&t.length&&this.getHtml().removeChild(t[0]),this.fDisplayName=!1},e.prototype.addMap=function(t,e){var n=["DarkOrange","ForestGreen"],r=document.createElement("div");r.id="_map_",r.style.position="absolute",r.style.width=this.map2SceneX(t.first().size())+"px",r.style.height=this.map2SceneY(t.second().size())+"px",r.style.left=this.map2SceneX(t.first().first())+"px",r.style.top=this.map2SceneY(t.second().first())+"px",r.style.backgroundColor=n[e%2],r.style.opacity="0.4",this.getHtml().appendChild(r),this.fDisplayMap=!0},e.prototype.removeMap=function(){for(var t=this.getHtml().querySelectorAll("#_map_"),e=t.length,n=0;e>n;n++)this.getHtml().removeChild(t[n]);this.fDisplayMap=!1},e.prototype.showMap=function(t){for(var e=t.fMapping.getRelations(),n=0;n<e.length;n++)this.addMap(e[n].fGraph,n)},e.prototype.mouseEvent=function(t,e,n){n.stopPropagation();var r=this.getHtml(),o=this.getRelativeCoord(n,r),i=this.scene2MapX(o.abs.x)/t.fPosition.getScale(),s=this.scene2MapY(o.abs.y)/t.fPosition.getScale(),a=t.mapPoint2Date({x:i,y:s}),u=this.getRelativeCoord(n,r.parentElement);t.handleMouseEvent(e,{rel:o.rel,abs:o.abs,parent:u.rel},a)},e.prototype.getRelativeCoord=function(t,e){var n,r=e.getBoundingClientRect(),o=t.pageX-(r.left+window.scrollX),i=t.pageY-(r.top+window.scrollY),s=document.body,a=document.documentElement,u=Math.max(s.scrollHeight,s.offsetHeight,a.clientHeight,a.scrollHeight,a.offsetHeight);return n="BODY"==e.tagName?i/(u/2)-1:i/(r.height/2)-1,{abs:{x:o,y:i},rel:{x:o/(r.width/2)-1,y:n}}},e.prototype.removeAllEvents=function(t){t.onmousedown=null,t.onmouseup=null,t.onmouseenter=null,t.onmouseleave=null,t.ondblclick=null},e.prototype.updateEvents=function(t){var e=this,n=t.hasUIEvents(),r=this.getHtml();n?(n&eUIEvents.kMouseDown?r.onmousedown=function(n){return e.mouseEvent(t,eUIEvents.kMouseDown,n)}:r.onmousedown=null,n&eUIEvents.kMouseMove?r.onmousemove=function(n){return 1==n.buttons?e.mouseEvent(t,eUIEvents.kMouseMove,n):null}:r.onmousemove=null,n&eUIEvents.kMouseUp?r.onmouseup=function(n){return e.mouseEvent(t,eUIEvents.kMouseUp,n)}:r.onmouseup=null,n&eUIEvents.kMouseEnter?r.onmouseenter=function(n){return e.mouseEvent(t,eUIEvents.kMouseEnter,n)}:r.onmouseenter=null,n&eUIEvents.kMouseLeave?r.onmouseleave=function(n){return e.mouseEvent(t,eUIEvents.kMouseLeave,n)}:r.onmouseleave=null):this.removeAllEvents(r)},e.prototype.colorTarget=function(){return this.fHtmlElt},e.prototype.updateColor=function(t){if(t.fColor.modified()){var e=this.colorTarget();e.style.color=t.fColor.getRGBString();var n=t.fColor.getA()/255;e.style.opacity=n.toString()}},e.prototype.updatePenControl=function(t){var n=t.fPenControl.getPenWidth(),r=t.fPenControl.getPenColor().getRGBString(),o=e.penStyle2Dash(t.fPenControl.getPenStyleNum()),i=(t.fPenControl.getPenColor().getA(),this.getHtml());i.style.borderWidth=n+"px",i.style.borderColor=r,i.style.borderStyle=o},e.prototype.getSize=function(t){var e=t.getSize(),n=t.fPenControl.getPenWidth(),r=this.relative2SceneWidth(e.w)+n,o=this.relative2SceneHeight(e.h)+n;return{w:r?r:1,h:o?o:1}},e.prototype.updatePos=function(t){var e=this.fPositionHandler();if(e.x==kNoPosition)return void(this.getHtml().style.visibility="hidden");var n=this.getSize(t),r=t.fPosition.getZOrder(),o=this.relative2SceneX(e.x),i=this.relative2SceneY(e.y);this.setPos(i,o,n.w,n.h);var s=t.fPosition.getShear(),a=this.getHtml();a.style.width=n.w+"px",a.style.height=n.h+"px",a.style.left=o+"px",a.style.top=i+"px",a.style.zIndex=r.toString(),a.style.transform=this.getTransform(t)+" skewX("+s[0]+"rad) skewY("+s[1]+"rad)",a.style.visibility=t.fPosition.getVisible()?"inherit":"hidden"},e.prototype.updateObjectSize=function(t){var e=this.scene2RelativeWidth(this.fHtmlElt.clientWidth),n=this.scene2RelativeHeight(this.fHtmlElt.clientHeight);t.fPosition.setWidth(e),t.fPosition.setHeight(n)},e.prototype.getParentsScale=function(t){var e=t.getParent();return e?e.fPosition.getScale()*this.getParentsScale(e):1},e.prototype.getViewScale=function(t){return t.fPosition.getScale()*this.getParentsScale(t)},e.prototype.getScale=function(t){var e=this.getViewScale(t);return 1==e?"":"scale("+e+","+e+") "},e.prototype.getTranslate=function(t){var e=t.fPosition.getScale(),n=t.fPosition.getXOrigin()*e,r=t.fPosition.getYOrigin()*e;return this.fTranslateX=-this.fWidth*(1+n)/2,this.fTranslateY=-this.fHeight*(1+r)/2,this.fTranslateX||this.fTranslateY?"translate("+this.fTranslateX+"px,"+this.fTranslateY+"px) ":" "},e.prototype.getRotateX=function(t){var e=t.getRotate();return e.x?"rotateX("+e.x+"deg)":""},e.prototype.getRotateY=function(t){var e=t.getRotate();return e.y?"rotateY("+e.y+"deg)":""},e.prototype.getRotateZ=function(t){var e=t.getRotate();return e.z?"rotateZ("+e.z+"deg) ":""},e.prototype.getTransform=function(t){return this.getTranslate(t)+this.getScale(t)+this.getRotateX(t)+this.getRotateY(t)+this.getRotateZ(t)},e.prototype.setPos=function(t,e,n,r){this.fTop=t,this.fLeft=e,this.fWidth=n,this.fHeight=r},e.prototype.updateEffects=function(t){if(t.fEffect.fEffectModified){this.getHtml();switch(t.fEffect.type()){case eEffect.kNone:this.setNone();break;case eEffect.kBlur:this.setBlur(t.fEffect.param(0));break;case eEffect.kShadow:this.setShadow(t.fEffect.params())}}},e.prototype.setNone=function(){this.setBlur(0)},e.prototype.setBlur=function(t){this.getHtml().style.boxShadow="(0px 0px)",this.getHtml().style.filter="blur( "+t+"px)"},e.prototype.setShadow=function(t){var e=new IColor(t.slice(2,6));this.getHtml().style.boxShadow=e.getCSSRGBAString()+t[0]+"px "+t[1]+"px "+t[6]+"px",this.getHtml().style.filter="blur(0)"},e.penStyle2Dash=function(t){switch(t){case 0:return"solid";case 1:return"dashed";case 2:return"dotted";default:return"solid"}},e.prototype.positionString=function(){return"top: "+this.fTop+" left: "+this.fLeft+" w: "+this.fWidth+" h: "+this.fHeight},e.prototype.relative2SceneY=function(t){return this.fParent.fHeight*(t+1)/2},e.prototype.relative2SceneX=function(t){return this.fParent.fWidth*(t+1)/2},e.prototype.relative2SceneWidth=function(t){return Math.min(this.fParent.fWidth,this.fParent.fHeight)*t/2},e.prototype.relative2SceneHeight=function(t){return Math.min(this.fParent.fWidth,this.fParent.fHeight)*t/2},e.prototype.scene2RelativeWidth=function(t){return 2*t/this.fParent.fWidth},e.prototype.scene2RelativeHeight=function(t){return 2*t/this.fParent.fHeight},e.prototype.scene2RelativeX=function(t){return t/(this.fParent.fWidth/2)-1},e.prototype.scene2RelativeY=function(t){return t/(this.fParent.fHeight/2)-1},e.prototype.map2SceneX=function(t){return this.fWidth*t},e.prototype.map2SceneY=function(t){return this.fHeight*t},e.prototype.scene2MapX=function(t){return t/this.fWidth},e.prototype.scene2MapY=function(t){return t/this.fHeight},e.prototype.initialize=function(t){},e}(VObjectView),VHtmlSvg=function(t){function e(e){var n=t.call(this,document.createElement("div"),e)||this;return n.fSVG=document.createElementNS("http://www.w3.org/2000/svg","svg"),n.fSVG.setAttribute("xmlns","http://www.w3.org/2000/svg"),n.fSVG.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),n.fSVG.setAttribute("version","1.1"),n.getHtml().appendChild(n.fSVG),n}return __extends(e,t),e.prototype.updateColor=function(t){var e=this.getSVGTarget(),n=(t.fColor.modified()||t.fBrushStyle.brushModified())&&t.fBrushStyle.getBrushStyle()!=eBrushStyle.kNone;t.fBrushStyle.brushModified()&&t.fBrushStyle.getBrushStyle()==eBrushStyle.kNone?e.style.fill="none":n&&(e.style.fill=t.fColor.getRGBAString(),e.style.fillOpacity=t.fColor.getSVGA().toString())},e.prototype.getInnerSize=function(t){var e=t.fPenControl.getPenWidth(),n=this.fWidth-e,r=this.fHeight-e;return{w:n?n:1,h:r?r:1}},e.prototype.updateView=function(e){t.prototype.updateView.call(this,e),this.fSVG.style.width=this.fWidth+"px",this.fSVG.style.height=this.fHeight+"px",this.fSVG.style.verticalAlign="top",this.fSVG.style.overflow="visible"},e.prototype.basePenControl=function(e){t.prototype.updatePenControl.call(this,e)},e.prototype.updatePenControl=function(t){t.fPenControl.modified()&&(this.fSVG.style.strokeWidth=t.fPenControl.getPenWidth().toString(),this.fSVG.style.stroke=t.fPenControl.getPenColor().getRGBString(),this.fSVG.style.strokeOpacity=(t.fPenControl.getPenAlpha()/255).toString(),this.fSVG.style.strokeDasharray=e.penStyle2Dash(t.fPenControl.getPenStyleNum()))},e.prototype.getViewScale=function(t){return t.fPosition.getScale()},e.prototype.updateCommonSVG=function(t,e,n){var r=this.getSVGTarget();r.setAttribute("width",e.toString()),r.setAttribute("height",n.toString()),r.style.transform=this.strokeTranslate(t)},e.prototype.innerTranslate=function(t){var e=t.fPenControl.getPenWidth()/2;return{x:e,y:e}},e.prototype.strokeTranslate=function(t){var e=this.innerTranslate(t);return e.x||e.y?"translate("+e.x+"px,"+e.y+"px) ":"none"},e.prototype.setNone=function(){this.fSVG.setAttribute("filter","blur(0px)")},e.prototype.setBlur=function(t){this.fSVG.setAttribute("filter","blur("+t+"px)")},e.prototype.setShadow=function(t){var e=new IColor(t.slice(2,6));this.fSVG.setAttribute("filter","drop-shadow("+e.getCSSRGBAString()+t[0]+"px "+t[1]+"px "+t[6]+"px)")},e.penStyle2Dash=function(t){switch(t){case 1:return"4, 4";case 2:return"1, 5";case 3:return"4, 4, 1, 5";case 4:return"4, 4, 1, 5, 1, 5";default:return""}},e}(VHtmlView),TPoint=function(){function t(t,e){this.fX=t,this.fY=e}return t.prototype.toArray=function(){return[this.fX,this.fY]},t.prototype.toString=function(){return this.toArray().toString()},t.prototype.getX=function(){return this.fX},t.prototype.getY=function(){return this.fY},t.prototype.equal=function(t){return this.fX==t.fX&&this.fY==t.fY},t}(),IRectShape=function(t){function e(e,n){return t.call(this,e,n)||this}return __extends(e,t),e.prototype.create=function(t,n){return new e(t,n)},e.prototype.setHandlers=function(){var e=this;t.prototype.setHandlers.call(this),this.brushAble(),this.fMsgHandlerMap[kwidth_GetSetMethod]=new TMsgHandlerNum(function(t){e.setWidth(t)}),this.fMsgHandlerMap[kheight_GetSetMethod]=new TMsgHandlerNum(function(t){e.setHeight(t)})},e.prototype.set=function(e){var n=t.prototype.set.call(this,e);if(n&eMsgStatus.kProcessed+eMsgStatus.kProcessedNoChange)return n;if(4==e.size()){var r=e.paramNum(2),o=e.paramNum(3);if(!r.correct||!o.correct)return eMsgStatus.kBadParameters;r.value!=this.fPosition.getWidth()||o.value!=this.fPosition.getHeight()?(this.fPosition.setWidth(r.value),this.fPosition.setHeight(o.value),this.newData(!0),n=eMsgStatus.kProcessed):n=eMsgStatus.kProcessedNoChange}else n=eMsgStatus.kBadParameters;return n},e.prototype.getSet=function(){return new IMessage(this.getOSCAddress(),[kset_SetMethod,this.fTypeString,this.fPosition.getWidth(),this.fPosition.getHeight()])},e}(IObject),IArc=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.fTypeString=kArcType,r.fStart=0,r.fRange=0,r.fClose=0,r.fPenControl.setPenWidth(1),r.fBrushStyle.fBrush=eBrushStyle.kNone,r}return __extends(e,t),e.prototype.setHandlers=function(){var e=this;t.prototype.setHandlers.call(this),this.fMsgHandlerMap[kstart_GetSetMethod]=new TMsgHandlerNum(function(t){e.setStart(t)}),this.fMsgHandlerMap[krange_GetSetMethod]=new TMsgHandlerNum(function(t){e.setRange(t)}),this.fMsgHandlerMap[kclose_GetSetMethod]=new TMsgHandlerNum(function(t){e.setClose(t)}),this.fMsgHandlerMap[kdrange_SetMethod]=new TMsgHandlerNum(function(t){e.setDRange(t)}),this.fMsgHandlerMap[kdstart_SetMethod]=new TMsgHandlerNum(function(t){e.setDStart(t)}),this.fGetMsgHandlerMap[kstart_GetSetMethod]=new TGetMsgHandlerNum(function(){return e.getStart()}),this.fGetMsgHandlerMap[krange_GetSetMethod]=new TGetMsgHandlerNum(function(){return e.getRange()}),this.fGetMsgHandlerMap[kclose_GetSetMethod]=new TGetMsgHandlerNum(function(){return e.getClose()})},e.prototype.set=function(e){var n=t.prototype.set.call(this,e);if(n&eMsgStatus.kProcessed+eMsgStatus.kProcessedNoChange)return n;if(6==e.size()){var r=e.paramNum(2),o=e.paramNum(3);if(!r.correct||!o.correct)return eMsgStatus.kBadParameters;var i=e.paramNum(4),s=e.paramNum(5);if(!i.correct||!s.correct)return eMsgStatus.kBadParameters;r.value!=this.fPosition.getWidth()||o.value!=this.fPosition.getHeight()||i.value!=this.fStart||s.value!=this.fRange?(this.fPosition.setWidth(r.value),this.fPosition.setHeight(o.value),this.fStart=i.value,this.fRange=s.value,this.newData(!0),n=eMsgStatus.kProcessed):n=eMsgStatus.kProcessedNoChange}else n=eMsgStatus.kBadParameters;return n},e.prototype.getSet=function(){return new IMessage(this.getOSCAddress(),[kset_SetMethod,this.fTypeString,this.fPosition.getWidth(),this.fPosition.getHeight(),this.getStart(),this.getRange()])},e.prototype.getStart=function(){return this.fStart},e.prototype.getRange=function(){return this.fRange},e.prototype.getClose=function(){return this.fClose},e.prototype.setStart=function(t){this.fStart=t},e.prototype.setRange=function(t){this.fRange=t},e.prototype.setClose=function(t){this.fClose=t},e.prototype.setDRange=function(t){this.setRange(this.fRange+t)},e.prototype.setDStart=function(t){this.setStart(this.fStart+t)},e}(IRectShape),VHtmlArcView=function(t){function e(e){var n=t.call(this,e)||this;return n.fArc=document.createElementNS("http://www.w3.org/2000/svg","path"),n.getHtml().className="inscore-arc",n.fSVG.appendChild(n.fArc),n}return __extends(e,t),e.prototype.getSVGTarget=function(){return this.fArc},e.prototype.updateView=function(n){t.prototype.updateView.call(this,n);var r=this.getInnerSize(n);this.updateCommonSVG(n,r.w,r.h);var o=n,i=r.w/2,s=r.h/2,a=this.normalize(o.getStart()),u=this.normalize(a+e.clip(o.getRange())),f=e.getPoint(i,s,a),h=e.getPoint(i,s,u),c=e.getPath(e.clip(o.getRange()),f,h,i,s,o.getClose()?!0:!1);this.fArc.setAttribute("d",c)},e.getPoint=function(t,e,n){n=n*Math.PI/180;var r=t*(Math.cos(n)+1),o=e*(-Math.sin(n)+1);return new TPoint(r,o)},e.getPath=function(t,n,r,o,i,s){t=e.clip(t);var a=e.direction(t),u=n+" A "+o+","+i+", 0,"+a.sup+","+a.dir+" "+r;return s?"M "+o+","+i+" L "+u+" Z ":"M "+u},e.prototype.normalize=function(t){return t>180?this.normalize(t-360):-180>t?this.normalize(t+360):t},e.clip=function(t){return t>=360?359:-360>=t?-359:t},e.direction=function(t){var e=t>0?0:1;t=Math.abs(t);var n=t>=180?1:0;return{sup:n,dir:e}},e}(VHtmlSvg),BezierCurve=function(){function t(t,e,n,r,o,i,s,a){this.fPoints=new Array,this.fPoints.push(new TPoint(t,e)),this.fPoints.push(new TPoint(n,r)),this.fPoints.push(new TPoint(o,i)),this.fPoints.push(new TPoint(s,a))}return t.prototype.equal=function(t){return this.fPoints.every(function(e,n){return e.equal(t.fPoints[n])})},t.prototype.points=function(){return this.fPoints},t.prototype.toArray=function(){for(var t=new Array,e=1;e<this.fPoints.length;e++)t=t.concat(this.fPoints[e].toArray());return t},t}(),ICurve=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.fTypeString=kCurveType,r.fPoints=new Array,r.fPenControl.setPenWidth(1),r}return __extends(e,t),e.prototype.setHandlers=function(){var e=this;t.prototype.setHandlers.call(this),this.brushAble(),this.fGetMsgHandlerMap[""]=new TGetMsgHandlerArray(function(){return e.getPoints()})},e.prototype.setPoints=function(t){this.fPoints=t},e.prototype.getPoints=function(){return this.fPoints},e.prototype.set=function(e){var n=t.prototype.set.call(this,e);if(n&eMsgStatus.kProcessed+eMsgStatus.kProcessedNoChange)return n;if(e.size()>1&&e.size()%8==2){for(var r=new Array,o=2;o<e.size();o+=8){var i=e.paramNum(o),s=e.paramNum(o+1),a=e.paramNum(o+2),u=e.paramNum(o+3),f=e.paramNum(o+4),h=e.paramNum(o+5),c=e.paramNum(o+6),l=e.paramNum(o+7);if(!(i.correct&&s.correct&&a.correct&&u.correct&&f.correct&&h.correct&&c.correct&&l.correct))return eMsgStatus.kBadParameters;var p=new BezierCurve(i.value,s.value,a.value,u.value,f.value,h.value,c.value,l.value);r.push(p)}if(r.length!=this.getPoints().length)return this.setPoints(r),this.newData(!0),eMsgStatus.kProcessed;for(var o=0;o<r.length;o++)if(r[o]!=this.getPoints()[o])return this.setPoints(r),this.newData(!0),eMsgStatus.kProcessed}return eMsgStatus.kBadParameters},e.prototype.toArray=function(){for(var t=new Array,e=0;e<this.fPoints.length;e++)t=t.concat(this.fPoints[e].toArray());return t},e.prototype.toString=function(){for(var t="",e=0;e<this.fPoints.length;e++)t+=this.fPoints[e].toString();return t},e.prototype.getSet=function(){var t=[kset_SetMethod,this.fTypeString];return new IMessage(this.getOSCAddress(),t.concat(this.toArray()))},e}(IObject),VHtmlCurveView=function(t){function e(e){var n=t.call(this,e)||this;return n.fCurve=document.createElementNS("http://www.w3.org/2000/svg","path"),n.getHtml().className="inscore-curve",n.fSVG.appendChild(n.fCurve),n}return __extends(e,t),e.prototype.getSVGTarget=function(){return this.fCurve},e.prototype.getSize=function(t){var e=this.fCurve.getBBox(),n=t.fPenControl.getPenWidth();return{w:e.width+n,h:e.height+n}},e.prototype.relative2SceneCurve=function(t){var e=t.points(),n=this.relative2SceneWidth(e[0].getX()),r=this.relative2SceneWidth(e[0].getY()),o=this.relative2SceneWidth(e[1].getX()),i=this.relative2SceneWidth(e[1].getY()),s=this.relative2SceneWidth(e[2].getX()),a=this.relative2SceneWidth(e[2].getY()),u=this.relative2SceneWidth(e[3].getX()),f=this.relative2SceneWidth(e[3].getY()),h=Math.min(r,f),c=h;return[n-c,r-h,o-c,i-h,s-c,a-h,u-c,f-h]},e.prototype.updateView=function(e){var n=e;if(e.isNewData()){for(var r=n.getPoints(),o=0;o<r.length;o++){var i=(r[o].points(),this.relative2SceneCurve(r[o]));this.fStart=new TPoint(i[0],i[1]),this.fEnd=new TPoint(i[6],i[7]);var s="M"+this.fStart.getX()+","+this.fStart.getY()+" C"+i[2]+","+i[3]+" "+i[4]+","+i[5]+" "+this.fEnd.getX()+","+this.fEnd.getY();this.fCurve.setAttribute("d",s)}this.fCurve.style.transform=this.strokeTranslate(e)}t.prototype.updateView.call(this,e)},e.prototype.innerTranslate=function(e){var n=t.prototype.innerTranslate.call(this,e),r=this.fCurve.getBBox(),o=Math.min(this.fStart.getX(),this.fEnd.getX()),i=Math.max(this.fStart.getX(),this.fEnd.getX()),s=Math.min(this.fStart.getY(),this.fEnd.getY()),a=Math.max(this.fStart.getY(),this.fEnd.getY());return o>0&&i>0?n.x+=-o:0>o&&0>i?n.x+=-i:n.x+=r.width-i,s>0&&a>0?n.y+=-s:0>s&&0>a?n.y+=-a:n.y+=r.height-a,n},e.prototype.updateObjectSize=function(t){var e=this.scene2RelativeWidth(this.fSVG.clientWidth),n=this.scene2RelativeHeight(this.fSVG.clientHeight);t.fPosition.setWidth(e),t.fPosition.setHeight(n)},e}(VHtmlSvg),IEllipse=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.fTypeString=kEllipseType,r}return __extends(e,t),e}(IRectShape),VHtmlEllipseView=function(t){function e(e){var n=t.call(this,e)||this;return n.fEllipse=document.createElementNS("http://www.w3.org/2000/svg","ellipse"),n.getHtml().className="inscore-ellipse",n.fSVG.appendChild(n.fEllipse),n}return __extends(e,t),e.prototype.getSVGTarget=function(){return this.fEllipse},e.prototype.updateView=function(e){t.prototype.updateView.call(this,e);var n=this.getInnerSize(e);this.updateCommonSVG(e,n.w,n.h);var r=n.w/2,o=n.h/2;this.fEllipse.setAttribute("cx",r.toString()),this.fEllipse.setAttribute("cy",o.toString()),this.fEllipse.setAttribute("rx",r.toString()),this.fEllipse.setAttribute("ry",o.toString())},e}(VHtmlSvg),ISVG=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.fTypeString=kSvgType,t.prototype.setHandlers.call(r),r}return __extends(e,t),e.prototype.setSvg=function(t){this.fSvg=t},e.prototype.getSvg=function(){return this.fSvg},e.prototype.set=function(e){var n=t.prototype.set.call(this,e);if(n&eMsgStatus.kProcessed+eMsgStatus.kProcessedNoChange)return n;var r=e.size();if(3==r){var o=e.paramStr(2);if(!o.correct)return eMsgStatus.kBadParameters;o.value!=this.getSvg()?(this.setSvg(o.value),this.newData(!0),n=eMsgStatus.kProcessed):n=eMsgStatus.kProcessedNoChange}else n=eMsgStatus.kBadParameters;return n},e.prototype.getSet=function(){return new IMessage(this.getOSCAddress(),[kset_SetMethod,this.fTypeString,this.getSvg()])},e}(IObject),VHtmlSvgView=function(t){function e(e){var n=t.call(this,document.createElement("div"),e)||this;return n.fClientWidth=0,n.fClientHeight=0,n.getHtml().className="inscore-svg",n}return __extends(e,t),e.prototype.getSVGElement=function(){var t=this.getHtml().childNodes;if(t.length)for(var e=0;e<t.length;e++)if(t[e]instanceof SVGSVGElement)return t[e];return null},e.prototype.updateView=function(e){if(e.isNewData()){var n=this.getSVGElement(),r=n?n:this.getHtml();r.innerHTML=this.getSVGCode(e),this.updateObjectSize(e)}t.prototype.updateView.call(this,e)},e.prototype.getSVGCode=function(t){var e=t;return e.getSvg()},e.prototype.getsvg=function(t){for(var e,n=t.childNodes,r=0;r<n.length&&!e;r++)if("svg"==n[r].nodeName){e=n[r];break}return e},e.prototype.getClientSize=function(t){if(!this.fClientWidth){var e=this.getsvg(this.getHtml()),n=e.viewBox.baseVal;this.fClientWidth=n.width,this.fClientHeight=n.height}return{w:this.fClientWidth,h:this.fClientHeight}},e.prototype.getSize=function(t){var e=this.getClientSize(t),n=t.fPenControl.getPenWidth(),r=e.w+n,o=e.h+n;return{w:r?r:1,h:o?o:1}},e.prototype._updateView=function(t){var e=this;return function(){return e.updateView(t)}},e.prototype.updateObjectSize=function(t){if(!t.fPosition.getWidth()){var e=this.getClientSize(t),n=this.scene2RelativeWidth(e.w),r=this.scene2RelativeHeight(e.h);t.fPosition.setWidth(n),t.fPosition.setHeight(r),n&&r||setTimeout(this._updateView(t),50)}},e.prototype.setNone=function(){this.getsvg(this.getHtml()).setAttribute("filter","blur(0px)")},e.prototype.setBlur=function(t){this.getsvg(this.getHtml()).setAttribute("filter","blur("+t+"px)")},e.prototype.setShadow=function(t){var e=new IColor(t.slice(2,6));this.getsvg(this.getHtml()).setAttribute("filter","drop-shadow("+e.getCSSRGBAString()+t[0]+"px "+t[1]+"px "+t[6]+"px)")},e}(VHtmlView),GuidoMapping;!function(t){t[t.kNoMapping=0]="kNoMapping",t[t.kVoiceMapping=1]="kVoiceMapping",t[t.kStaffMapping=2]="kStaffMapping",t[t.kSystemMapping=4]="kSystemMapping"}(GuidoMapping||(GuidoMapping={}));var GuidoErrCode;!function(t){t[t.guidoNoErr=0]="guidoNoErr",t[t.guidoErrParse=-1]="guidoErrParse",t[t.guidoErrMemory=-2]="guidoErrMemory",t[t.guidoErrFileAccess=-3]="guidoErrFileAccess",t[t.guidoErrUserCancel=-4]="guidoErrUserCancel",t[t.guidoErrNoMusicFont=-5]="guidoErrNoMusicFont",t[t.guidoErrNoTextFont=-6]="guidoErrNoTextFont",t[t.guidoErrBadParameter=-7]="guidoErrBadParameter",t[t.guidoErrInvalidHandle=-8]="guidoErrInvalidHandle",t[t.guidoErrNotInitialized=-9]="guidoErrNotInitialized",t[t.guidoErrActionFailed=-10]="guidoErrActionFailed"}(GuidoErrCode||(GuidoErrCode={}));var GuidoElementSelector;!function(t){t[t.kGuidoPage=0]="kGuidoPage",t[t.kGuidoSystem=1]="kGuidoSystem",t[t.kGuidoSystemSlice=2]="kGuidoSystemSlice",t[t.kGuidoStaff=3]="kGuidoStaff",t[t.kGuidoBar=4]="kGuidoBar",t[t.kGuidoEvent=5]="kGuidoEvent",t[t.kGuidoScoreElementEnd=6]="kGuidoScoreElementEnd"}(GuidoElementSelector||(GuidoElementSelector={}));
var GuidoElementType;!function(t){t[t.kNote=1]="kNote",t[t.kRest=2]="kRest",t[t.kEmpty=3]="kEmpty",t[t.kBar=4]="kBar",t[t.kRepeatBegin=5]="kRepeatBegin",t[t.kRepeatEnd=6]="kRepeatEnd",t[t.kStaff=7]="kStaff",t[t.kSystemSlice=8]="kSystemSlice",t[t.kSystem=9]="kSystem",t[t.kPage=10]="kPage"}(GuidoElementType||(GuidoElementType={}));var PianoRollType;!function(t){t[t.kSimplePianoRoll=0]="kSimplePianoRoll",t[t.kTrajectoryPianoRoll=1]="kTrajectoryPianoRoll"}(PianoRollType||(PianoRollType={}));var IGuidoCode=function(_super){function IGuidoCode(t,e){var n=_super.call(this,t,e)||this;return IGuidoCode.fGuidoEngine||(IGuidoCode.fGuidoEngine=new Module.GuidoEngineAdapter,IGuidoCode.fGuidoEngine.init(),IGuidoCode.fGuidoMap=new Module.GUIDOScoreMap),n.fTypeString=kGuidoCodeType,n.fCurrentPagesCount=1,n.fPage=1,n.fPosition.setWidth(0),n.fPosition.setHeight(0),_super.prototype.setHandlers.call(n),n}return __extends(IGuidoCode,_super),IGuidoCode.prototype.setSVG=function(t){this.fSVG=t},IGuidoCode.prototype.setPage=function(t){this.fPage=t},IGuidoCode.prototype.setPageFormat=function(t){this.fPageFormat=t},IGuidoCode.prototype.getSVG=function(){return this.fSVG},IGuidoCode.prototype.getPage=function(){return this.fPage},IGuidoCode.prototype.getPageFormat=function(){return this.fPageFormat},IGuidoCode.prototype.guidoMap2inscoreMap=function(json){var _this=this,map=eval(json);map.length&&this.fMapping.clear(),map.forEach(function(t){var e=new TimeInterval(new Fraction(t.time.start),new Fraction(t.time.end)),n=new TGraphicSegment(new NumberInterval(t.graph.left,t.graph.right),new NumberInterval(t.graph.top,t.graph.bottom));_this.fMapping.addElt(new TTime2GraphicRelation(e,n))})},IGuidoCode.prototype.getMap=function(t){this.guidoMap2inscoreMap(IGuidoCode.fGuidoMap.getSystemMap(t,1,1,1))},IGuidoCode.prototype.str2AR=function(t){var e=IGuidoCode.fGuidoEngine.openParser(),n=IGuidoCode.fGuidoEngine.string2AR(e,t);if(!n){var r=IGuidoCode.fGuidoEngine.parserGetErrorCode(e);ITLError.write("Error line "+r.line+" column "+r.col+": "+r.msg)}return IGuidoCode.fGuidoEngine.closeParser(e),n},IGuidoCode.prototype.mapScale=function(t,e){this.fMapping.forEach(function(n){n.fGraph.scale(t,e)})},IGuidoCode.prototype.AR2SVG=function(t){var e=this,n=IGuidoCode.fGuidoEngine.ar2gr(t),r=IGuidoCode.fGuidoEngine.gr2SVG(n,1,!1,0);return this.getMap(n),this.getViews()[0].setMapScaleHandler(function(t,n){e.mapScale(t,n)}),IGuidoCode.fGuidoEngine.freeGR(n),r},IGuidoCode.prototype.set=function(t){var e=_super.prototype.set.call(this,t);if(e&eMsgStatus.kProcessed+eMsgStatus.kProcessedNoChange)return e;if(3!=t.size())return eMsgStatus.kBadParameters;var n=t.paramStr(2);if(!n.correct)return eMsgStatus.kBadParameters;var r=this.str2AR(n.value);return r?(this.fGMN=n.value,this.fSVG=this.AR2SVG(r),IGuidoCode.fGuidoEngine.freeAR(r),this.fNewData=!0,eMsgStatus.kProcessed):eMsgStatus.kBadParameters},IGuidoCode.prototype.getSet=function(){return new IMessage(this.getOSCAddress(),[kset_SetMethod,this.fTypeString,this.fGMN])},IGuidoCode}(IObject),VHtmlGMNView=function(t){function e(e){var n=t.call(this,e)||this;return n.getHtml().className="inscore-gmn",n.fMapScale=null,n}return __extends(e,t),e.prototype.setMapScaleHandler=function(t){this.fMapScale=t},e.prototype.getSVGCode=function(t){var e=t;return e.getSVG()},e.prototype.getFirstSVGGroup=function(t){for(var e,n=t.childNodes,r=0;r<n.length&&!e;r++){if("g"==n[r].nodeName){e=n[r];break}e=this.getFirstSVGGroup(n[r])}return e},e.prototype.setPos=function(e,n,r,o){if(t.prototype.setPos.call(this,e,n,r,o),this.fMapScale){var i=1,s=1;this.fWidth>this.fHeight?s=this.fWidth/this.fHeight:this.fWidth<this.fHeight&&(i=this.fHeight/this.fWidth),this.fMapScale(i,s),this.fMapScale=null}},e.prototype.updateColor=function(t){var e=t.fColor.getRGBString(),n=t.fColor.getSVGA(),r=this.getFirstSVGGroup(this.getHtml());r&&(r.style.stroke=e,r.style.strokeOpacity=n.toString(),r.style.fill=e,r.style.fillOpacity=n.toString())},e}(VHtmlSvgView),VHtmlAutoSize=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.fClientWidth=0,r.fClientHeight=0,r}return __extends(e,t),e.prototype.updateView=function(e){var n=this.getHtml();n.style.height="auto",n.style.width="auto",this.updateObjectSize(e),t.prototype.updateView.call(this,e)},e.prototype._updateView=function(t){var e=this;return function(){return e.updateView(t)}},e.prototype.updateObjectSize=function(t){var e=this.getClientSize(t),n=this.scene2RelativeWidth(e.w),r=this.scene2RelativeHeight(e.h);t.fPosition.setWidth(n),t.fPosition.setHeight(r),n&&r||setTimeout(this._updateView(t),50)},e.prototype.getClientSize=function(t){if(!this.fClientWidth){var e=this.getAutoElement();this.fClientWidth=e.clientWidth,this.fClientHeight=e.clientHeight}return{w:this.fClientWidth,h:this.fClientHeight}},e}(VHtmlView),IText=function(t){function e(n,r){var o=t.call(this,n,r)||this;return o.fTypeString=kTextType,o.fColor.setRGB([0,0,0]),o.fColor.setA(255),o.fFontSize=14,o.fFontFamily="Arial",o.fFontWeight=e.kWeightNormal,o.fFontStyle=e.kStyleNormal,o.fFontModified=!1,o}return __extends(e,t),e.prototype.setHandlers=function(){var e=this;t.prototype.setHandlers.call(this),this.fMsgHandlerMap[kfontSize_GetSetMethod]=new TMsgHandlerNum(function(t){e.setFontSize(t)}),this.fMsgHandlerMap[kfontFamily_GetSetMethod]=new TMsgHandlerText(function(t){e.setFontFamily(t)}),this.fMsgHandlerMap[kfontStyle_GetSetMethod]=new TMethodHandler(function(t){return e.setFontStyle(t)}),this.fMsgHandlerMap[kfontWeight_GetSetMethod]=new TMethodHandler(function(t){return e.setFontWeight(t)}),this.fGetMsgHandlerMap[""]=new TGetMsgHandlerText(function(){return e.getText()}),this.fGetMsgHandlerMap[kfontSize_GetSetMethod]=new TGetMsgHandlerNum(function(){return e.getFontSize()}),this.fGetMsgHandlerMap[kfontFamily_GetSetMethod]=new TGetMsgHandlerText(function(){return e.getFontFamily()}),this.fGetMsgHandlerMap[kfontStyle_GetSetMethod]=new TGetMsgHandlerText(function(){return e.getFontStyle()}),this.fGetMsgHandlerMap[kfontWeight_GetSetMethod]=new TGetMsgHandlerText(function(){return e.getFontWeight()})},e.prototype.fontModified=function(){return 0==this.fFontModified?this.fEffect.effectModified():this.fFontModified},e.prototype.getText=function(){return this.fText},e.prototype.setText=function(t){this.fText=t},e.prototype.getFontSize=function(){return this.fFontSize},e.prototype.setFontSize=function(t){this.fFontSize=t,this.fFontModified=!0},e.prototype.getFontFamily=function(){return this.fFontFamily},e.prototype.setFontFamily=function(t){this.fFontFamily=t,this.fFontModified=!0},e.prototype.getFontStyle=function(){return this.fFontStyle},e.prototype.setFontStyle=function(t){var n=t.size();if(2==n){var r=t.paramStr(1);if(r.correct&&(r.value==e.kStyleNormal||r.value==e.kStyleItalic||r.value==e.kStyleOblique))return this.fFontStyle=r.value,this.fFontModified=!0,eMsgStatus.kProcessed}return eMsgStatus.kBadParameters},e.prototype.getFontWeight=function(){return this.fFontWeight},e.prototype.setFontWeight=function(t){var n=t.size();if(2==n){var r=t.paramStr(1);if(r.correct&&(r.value==e.kWeightNormal||r.value==e.kWeightLight||r.value==e.kWeightDemiBold||r.value==e.kWeightBold||r.value==e.kWeightBlack))return this.fFontWeight=r.value,this.fFontModified=!0,eMsgStatus.kProcessed}return eMsgStatus.kBadParameters},e.prototype.set=function(e){var n=t.prototype.set.call(this,e);if(n&eMsgStatus.kProcessed+eMsgStatus.kProcessedNoChange)return n;var r=e.size();if(r>2){for(var o="",i="",s=2;r>s;s++)o+=i,o+=e.param(s),i=" ";this.setText(o),this.newData(!0),n=eMsgStatus.kProcessed}else n=eMsgStatus.kBadParameters;return n},e.prototype.getSet=function(){var t=[kset_SetMethod,this.fTypeString];return new IMessage(this.getOSCAddress(),t.concat(this.fText))},e}(IObject);IText.kStyleNormal="normal",IText.kStyleItalic="italic",IText.kStyleOblique="oblique",IText.kWeightNormal="normal",IText.kWeightLight="light",IText.kWeightDemiBold="demibold",IText.kWeightBold="bold",IText.kWeightBlack="black";var IHtml=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.fTypeString=kHtmlType,r}return __extends(e,t),e}(IText),VHtmlHtmlView=function(t){function e(e){var n=t.call(this,document.createElement("div"),e)||this;return n.getHtml().className="inscore-html",n}return __extends(e,t),e.prototype.getText=function(t){return t.getText()},e.fontWeight2Num=function(t){switch(t){case IText.kWeightNormal:return"400";case IText.kWeightLight:return"200";case IText.kWeightDemiBold:return"550";case IText.kWeightBold:return"700";case IText.kWeightBlack:return"900";default:return"400"}},e.prototype.setFont=function(t){var n=this.getHtml();n.style.fontSize=t.getFontSize()+"px",n.style.fontFamily=t.getFontFamily(),n.style.fontStyle=t.getFontStyle(),n.style.fontWeight=e.fontWeight2Num(t.getFontWeight())},e.prototype.setNone=function(){this.getHtml().style.textShadow="0px 0px 0px"},e.prototype.setBlur=function(t){this.getHtml().style.textShadow="0px 0px "+t+"px"},e.prototype.setShadow=function(t){var e=new IColor(t.slice(2,6));this.getHtml().style.textShadow=e.getCSSRGBAString()+t[0]+"px "+t[1]+"px "+t[6]+"px"},e.prototype.updateView=function(e){var n=e,r=this.getHtml();r.innerHTML=this.getText(n),n.fontModified()&&this.setFont(n),t.prototype.updateView.call(this,e)},e.prototype.getAutoElement=function(){return this.getHtml()},e}(VHtmlAutoSize),IImage=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.fTypeString=kImgType,r}return __extends(e,t),e.prototype.colorAble=function(){},e.prototype.getFile=function(){return this.fFile},e.prototype.set=function(e){var n=t.prototype.set.call(this,e);if(n&eMsgStatus.kProcessed+eMsgStatus.kProcessedNoChange)return n;if(3==e.size()){var r=e.paramStr(2);if(!r.correct)return eMsgStatus.kBadParameters;this.fFile=r.value,this.newData(!0),n=eMsgStatus.kProcessed}else n=eMsgStatus.kBadParameters;return n},e.prototype.getSet=function(){return new IMessage(this.getOSCAddress(),[kset_SetMethod,this.fTypeString,"'"+this.getFile()+"'"])},e}(IObject),VHtmlImageView=function(t){function e(e){var n=this,r=document.createElement("img");return n=t.call(this,r,e)||this,n.fImage=r,n.getHtml().className="inscore-img",n}return __extends(e,t),e.prototype.updateView=function(e){var n=e;this.fImage.src=n.getFile(),t.prototype.updateView.call(this,e)},e.prototype.setShadow=function(t){var e=new IColor(t.slice(2,6));this.getHtml().style.filter="drop-shadow("+e.getCSSRGBAString()+" "+t[0]+"px "+t[1]+"px "+t[6]+"px)"},e.prototype.getAutoElement=function(){return this.fImage},e}(VHtmlAutoSize),ILine=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.fTypeString=kLineType,r.fPenControl.setPenWidth(1),r.fGetMsgHandlerMap[""]=new TGetMsgHandlerArray(function(){return r.fPoint.toArray()}),r}return __extends(e,t),e.prototype.setPoint=function(t){this.fPoint=t,this.fPosition.setWidth(Math.abs(t.getX())),this.fPosition.setHeight(Math.abs(t.getY()))},e.prototype.getPoint=function(){return this.fPoint},e.prototype.getColorTarget=function(){return this.fPenControl.fPenColor},e.prototype.set=function(e){var n=t.prototype.set.call(this,e);if(n&eMsgStatus.kProcessed+eMsgStatus.kProcessedNoChange)return n;if(5==e.size()){var r=e.paramStr(2),o=e.paramNum(3),i=e.paramNum(4);if(!r.correct)return eMsgStatus.kBadParameters;if(!o.correct||!i.correct)return eMsgStatus.kBadParameters;if("xy"==r.value)this.fWAMode=!1,this.setPoint(new TPoint(o.value,i.value));else{if("wa"!=r.value)return eMsgStatus.kBadParameters;this.fWAMode=!0,this.fLWidth=o.value,this.fLAngle=i.value,this.fLAngle<0&&(this.fLAngle+=360),180<=Math.abs(this.fLAngle)&&Math.abs(this.fLAngle)<=360&&(this.fLAngle-=180);var s=Math.round(o.value*Math.cos(Math.PI*this.fLAngle/180)*1e3)/1e3,a=Math.round(o.value*Math.sin(Math.PI*this.fLAngle/180)*1e3)/1e3;this.setPoint(new TPoint(s,a))}this.newData(!0),n=eMsgStatus.kProcessed}else n=eMsgStatus.kBadParameters;return n},e.prototype.getSetLine=function(t){return this.fWAMode?["wa",this.fLWidth,this.fLAngle]:["xy",this.fPoint.getX(),this.fPoint.getY()]},e.prototype.getSet=function(){return new IMessage(this.getOSCAddress(),this.getSetLine([kset_SetMethod,this.fTypeString]))},e}(IObject),VHtmlLineView=function(t){function e(e){var n=t.call(this,e)||this;return n.fLine=document.createElementNS("http://www.w3.org/2000/svg","line"),n.getHtml().className="inscore-line",n.fSVG.appendChild(n.fLine),n}return __extends(e,t),e.prototype.getSVGTarget=function(){return this.fLine},e.prototype.updateColor=function(t){t.fPenControl.fPenColor.modified()&&(this.fLine.style.stroke=t.fPenControl.getPenColor().getRGBString(),this.fLine.style.strokeOpacity=t.fPenControl.getPenColor().getSVGA().toString())},e.prototype.updateView=function(e){t.prototype.updateView.call(this,e);var n=e,r=n.getPoint(),o=this.relative2SceneWidth(r.getX()),i=this.relative2SceneWidth(r.getY()),s=0,a=0;0>o&&0>i?(o=-o,i=-i):0>o?(a=i,o=-o,i=0):0>i&&(a=-i,i=0),this.fLine.setAttribute("x1",s.toString()),this.fLine.setAttribute("x2",o.toString()),this.fLine.setAttribute("y1",a.toString()),this.fLine.setAttribute("y2",i.toString()),this.fLine.style.transform=this.strokeTranslate(e)},e}(VHtmlSvg),VHtmlPianoRollView=function(t){function e(e){var n=t.call(this,e)||this;return n.getHtml().className="inscore-pianoroll",n}return __extends(e,t),e.prototype.getViewScale=function(t){return t.fPosition.getScale()*this.getParentsScale(t)},e.prototype.updateObjectSize=function(t){},e}(VHtmlGMNView),IPolygon=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.fTypeString=kPolygonType,r.fPoints=new Array,r}return __extends(e,t),e.prototype.setHandlers=function(){t.prototype.setHandlers.call(this),this.brushAble(),this.fGetMsgHandlerMap[""]=new TGetMsgHandlerArray(this._getPoints())},e.prototype.setPoints=function(t){this.fPoints=t},e.prototype.getPoints=function(){return this.fPoints},e.prototype._getPoints=function(){var t=this;return function(){return t.fPoints}},e.prototype.set=function(e){var n=t.prototype.set.call(this,e);if(n&eMsgStatus.kProcessed+eMsgStatus.kProcessedNoChange)return n;if(e.size()>1&&(e.size()-1)%2==1){for(var r=new Array,o=2;o<e.size();o+=2){var i=e.paramNum(o),s=e.paramNum(o+1);if(!i.correct||!s.correct)return eMsgStatus.kBadParameters;r.push(new TPoint(i.value,s.value))}if(r.length!=this.getPoints().length)return this.setPoints(r),this.newData(!0),eMsgStatus.kProcessed;for(var o=0;o<r.length;o++)if(r[o]!=this.getPoints()[o])return this.setPoints(r),this.newData(!0),eMsgStatus.kProcessed;return eMsgStatus.kProcessedNoChange}return eMsgStatus.kBadParameters},e.prototype.getSet=function(){return new IMessage(this.getOSCAddress(),[kset_SetMethod,this.fTypeString,"todo"])},e}(IObject),VHtmlPolygonView=function(t){function e(e){var n=t.call(this,e)||this;return n.fPolygon=document.createElementNS("http://www.w3.org/2000/svg","polygon"),n.getHtml().className="inscore-polygon",n.fSVG.appendChild(n.fPolygon),n}return __extends(e,t),e.prototype.getSVGTarget=function(){return this.fPolygon},e.prototype.getSize=function(t){var e=t.fPenControl.getPenWidth(),n=this.fPolygon.getBBox();return{w:n.width+e,h:n.height+e}},e.prototype.updateView=function(e){var n=e;if(e.isNewData()){for(var r=n.getPoints(),o=536870911,i=536870911,s=0;s<r.length;s++)o=Math.min(o,r[s].getX()),i=Math.min(i,r[s].getY());for(var a="",s=0;s<r.length;s++){var u=this.relative2SceneWidth(r[s].getX()-o),f=this.relative2SceneWidth(r[s].getY()-i);a+=u+","+f+" "}this.fPolygon.setAttribute("points",a)}this.fPolygon.setAttribute("fill",e.fColor.getRGBString()),t.prototype.updateView.call(this,e);var h=this.getInnerSize(e);this.updateCommonSVG(e,h.w,h.h)},e.prototype.updateObjectSize=function(t){var e=this.getHtml(),n=this.scene2RelativeWidth(e.clientWidth),r=this.scene2RelativeHeight(e.clientHeight);t.fPosition.setWidth(n),t.fPosition.setHeight(r)},e}(VHtmlSvg),IRect=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.kRectType="rect",r.fTypeString=r.kRectType,r.fGetMsgHandlerMap[kradius_GetSetMethod]=new TGetMsgHandlerArray(r._getRadius()),r.fMsgHandlerMap[kradius_GetSetMethod]=new TMsgHandlerNumArray(r._setRadius()),r}return __extends(e,t),e.prototype.getRadius=function(){return this.fRadius},e.prototype.setRadius=function(t){return 2!=t.length?eMsgStatus.kBadParameters:(this.fRadius=t,eMsgStatus.kProcessed)},e.prototype._getRadius=function(){var t=this;return function(){return t.getRadius()}},e.prototype._setRadius=function(){var t=this;return function(e){return t.setRadius(e)}},e}(IRectShape),VHtmlRectView=function(t){function e(e){var n=t.call(this,e)||this;return n.fRect=document.createElementNS("http://www.w3.org/2000/svg","rect"),n.getHtml().className="inscore-rect",n.fSVG.appendChild(n.fRect),n}return __extends(e,t),e.prototype.getSVGTarget=function(){return this.fRect},e.prototype.updateView=function(e){t.prototype.updateView.call(this,e);var n=this.getInnerSize(e);this.updateCommonSVG(e,n.w,n.h);var r=e,o=r.getRadius();o&&(this.fRect.setAttribute("rx",o[0].toString()),this.fRect.setAttribute("ry",o[1].toString()))},e}(VHtmlSvg),TWindow=function(){function t(){}return t.getSize=function(){var t=Math.max(window.innerWidth,document.documentElement.clientWidth,document.body.clientWidth),e=Math.max(window.innerHeight,document.documentElement.clientHeight,document.body.clientHeight);return{w:t,h:e}},t}(),TILoader=function(){function t(){}return t.prototype.parse=function(t){try{return INScoreParser.parse(t),INScoreParser.get()}catch(e){}return[]},t.prototype.scanParam=function(t){var e=this;if(t.address)return console.log("scanParam message: "+t),new IMessage(t.address,this.scanParams(t.params));if(t instanceof Array){var n=new IMessageList;return t.forEach(function(t){n.push(e.scanParam(t))}),n}return t},t.prototype.scanParams=function(t){var e=this;console.log("scanParams : "+t);var n=[];return t.forEach(function(t){n.push(e.scanParam(t))}),n},t.prototype.process=function(t,e){var n=this.parse(t);if(n){var r=[];n.forEach(function(t){r.push(new IMessage(t.address.osc,t.params))}),r.forEach(function(t){INScore.postMessage(t.address(),t.params())})}},t.prototype._process=function(t,e){var n=this;return function(){var r=t.result;n.process(r,e)}},t.prototype.load=function(t,e){var n=new FileReader;n.readAsText(t),n.onloadend=this._process(n,e)},t}(),INScoreImpl=function(t){function e(){var e=t.call(this)||this;return e.fVersion=.6,e.fErrStrings=new Array,e.fErrStrings[eMsgStatus.kBadAddress]="bad OSC address",e.fErrStrings[eMsgStatus.kProcessed]="processed",e.fErrStrings[eMsgStatus.kProcessedNoChange]="processed without change",e.fErrStrings[eMsgStatus.kBadParameters]="bad parameter",e.fErrStrings[eMsgStatus.kCreateFailure]="create failed",e}return __extends(e,t),e.prototype.status2string=function(t){var e=this.fErrStrings[t];return e?e:"unknown error "+t},e.prototype.version=function(){return this.fVersion},e.prototype.start=function(t,e){this.fGlue||(this.fGlue=new IGlue,this.fGlue.initEventHandlers()),this.fGlue.start(t,e?e:"relative"),ITLOut.write("INScoreJS version "+this.version())},e.prototype.checkStatus=function(t,e){t&eMsgStatus.kProcessed+eMsgStatus.kProcessedNoChange||ITLError.write(e.toString()+": "+this.status2string(t))},e.prototype.getMessage=function(t,e){var n=[],r=new IMessage(t,["get"].concat(e)),o=this.fGlue.getRoot().getTargetObjects(OSCAddress.shift(t));return o.forEach(function(t){n=n.concat(t.getCall(r))}),n},e.prototype.postMessage=function(t,e){var n=new IMessage(t,e);this.fGlue.pushStack(n)},e.prototype.load=function(t){var e=new TILoader;"string"==typeof t?e.process(t,this.fGlue.getRoot()):e.load(t,this.fGlue.getRoot())},e.prototype.register=function(t){for(var e=document.getElementsByTagName(t),n=0;n<e.length;n++){var r=e[n].textContent;INScore.load(r),e[n].textContent=""}for(;e.length;)e[0].parentElement.removeChild(e[0])},e}(INScoreInterface);INScore=new INScoreImpl;var dropLoader=function(){function t(t){this.fExtHandlers={},this.fTarget=t,this.fTargetType=t.getAttribute("class"),this.buildObjectExtensions()}return t.prototype.buildObjectExtensions=function(){this.fExtHandlers.txt=kTextType,this.fExtHandlers.text=kTextType,this.fExtHandlers.svg=kSvgType,this.fExtHandlers.html=kHtmlType,this.fExtHandlers.htm=kHtmlType,this.fExtHandlers.gmn=kGuidoCodeType,this.fExtHandlers.jpg=kImgType,this.fExtHandlers.jpeg=kImgType,this.fExtHandlers.gif=kImgType,this.fExtHandlers.png=kImgType,this.fExtHandlers.bmp=kImgType,this.fExtHandlers.tiff=kImgType,this.fExtHandlers.wmv=kVideoType,this.fExtHandlers.avi=kVideoType,this.fExtHandlers.mpg=kVideoType,this.fExtHandlers.mpeg=kVideoType,this.fExtHandlers.mp4=kVideoType,this.fExtHandlers.m4v=kVideoType,this.fExtHandlers.mov=kVideoType,this.fExtHandlers.vob=kVideoType},t.prototype.processLoader=function(t){this.fTargetScene=this.targetScene();var e=t.dataTransfer.getData("Text");if(e)INScore.load(e);else{var n=t.dataTransfer.files;if(!n)return;for(var r=n.length,o=0;r>o;o++){var i=n[o],s=n[o].name,a=this.getFileProperties(s),u=a.name,f=a.ext.toLocaleLowerCase(),h=new FileReader;f==kInscoreFile?INScore.load(i):this.fExtHandlers[f]==kImgType||this.fExtHandlers[f]==kVideoType?INScore.postMessage("/ITL/"+this.fTargetScene+"/"+u,["set",this.fExtHandlers[f],s]):(h.readAsText(i),this.fExtHandlers[f]||(this.fExtHandlers[f]=kTextType),h.onloadend=this._processMsg(h,this.fTargetScene,u,this.fExtHandlers[f]))}}},t.prototype.targetScene=function(){var t,e=this.fTargetType,n=this.fTarget;if("inscore-scene"==e)t=this.fTarget.getAttribute("name");else{for(;"inscore-scene"!=e;)n=n.parentNode,e=n.getAttribute("class");t=n.getAttribute("name")}return t},t.prototype.getFileProperties=function(t){var e=t.substring(t.lastIndexOf(".")+1,t.length),n=t.substring(0,t.lastIndexOf("."));return n=this.buildCorrectName(n),{name:n,ext:e}},t.prototype.buildCorrectName=function(t){var e=/^[a-zA-Z-_][-_a-zA-Z0-9]+$/.test(t);if(!e){var n=t[0],r=/^[0-9]$/.test(n);r&&(t="_"+t);for(var o=1;o<t.length;o++){var i=/^[-_a-zA-Z0-9]$/.test(t[o]);i||(t=t.replace(t[o],"_"))}}return t},t.prototype._processMsg=function(t,e,n,r){return function(){var o=t.result;INScore.postMessage("/ITL/"+e+"/"+n,["set",r,o])}},t}(),VHtmlSceneContainer=function(t){function e(){return t.call(this,e.getHtml())||this}return __extends(e,t),e.getHtml=function(){var t=document.getElementsByTagName("script");return t[t.length-1].parentNode},e.prototype.setDefaultPositionStyle=function(){},e.prototype.updatePos=function(){var t=TWindow.getSize(),e=Math.min(t.w,t.h);this.setPos((t.h-e)/2,(t.w-e)/2,e,e)},e}(VHtmlView),VHtmlSceneView=function(t){function e(e){var n=this,r=new VHtmlSceneContainer;n=t.call(this,document.createElement("div"),r)||this,n.fDoc=r;var o=TWindow.getSize();n.fReferenceWidth=Math.min(Math.max(screen.width,o.w),Math.max(screen.height,o.h));var i=n.getHtml();return i.className="inscore-scene",i.setAttribute("name",e),i.addEventListener("drop",inscore_dropEvent,!1),i.addEventListener("dragover",inscore_dragOverEvent,!1),n.fAbsolutePos=!1,n}return __extends(e,t),e.prototype.setDefaultPositionStyle=function(){},e.prototype.getViewScale=function(t){return Math.min(t.fPosition.getWidth(),t.fPosition.getHeight())*t.fPosition.getScale()},e.prototype.relative2SceneX=function(e){return this.fParent.fLeft+t.prototype.relative2SceneX.call(this,e)},e.prototype.relative2SceneY=function(e){return this.fParent.fTop+t.prototype.relative2SceneY.call(this,e)},e.prototype.relative2SceneWidth=function(t){return this.fReferenceWidth*t/2},e.prototype.relative2SceneHeight=function(t){return this.fReferenceWidth*t/2},e.prototype.getTranslate=function(e){return this.fAbsolutePos?t.prototype.getTranslate.call(this,e):""},e.prototype.scenePosition=function(t){var e=t;this.fAbsolutePos=e.fAbsolutePos,this.fAbsolutePos&&(this.getHtml().style.position=IScene.kAbsolute)},e.prototype.updateColor=function(t){if(t.fColor.modified()){var e=this.colorTarget();e.style.backgroundColor=t.fColor.getRGBString();var n=t.fColor.getA()/255;e.style.opacity=n.toString()}},e.prototype.updateView=function(e){if(this.scenePosition(e),this.fDoc.updatePos(),this.fWidth=this.fHeight=this.fDoc.fWidth,t.prototype.updateView.call(this,e),!this.fAbsolutePos){var n=this.getHtml();n.style.left="",n.style.top=""}},e}(VHtmlView),ISVGf=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.fTypeString=kSvgfType,r}return __extends(e,t),e}(IImage),VHtmlSVGfView=function(t){function e(e){var n=t.call(this,e)||this;return n.getHtml().className="inscore-svgf",n}return __extends(e,t),e}(VHtmlImageView),VHtmlTextView=function(t){function e(e){var n=t.call(this,e)||this,r=n.getHtml();return r.className="inscore-txt",r.style.verticalAlign="middle",n}return __extends(e,t),e}(VHtmlHtmlView),IVideo=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.fTypeString=kVideoType,r.fPlay=0,r.fRate=1,r.fVolume=1,r.fVDate=new Fraction(0,1),r.fMLS=0,r.fVDuration=0,r.fMsgHandlerMap[kplay_GetSetMethod]=new TMsgHandlerNum(function(t){r.setPlay(t)}),r.fMsgHandlerMap[krate_GetSetMethod]=new TMsgHandlerNum(function(t){r.setRate(t)}),r.fMsgHandlerMap[kvolume_GetSetMethod]=new TMsgHandlerNum(function(t){r.setVolume(t)}),r.fMsgHandlerMap[kvdate_GetSetMethod]=new TMsgHandlerTime(function(t){r.setVDate(t)}),r.fGetMsgHandlerMap[kplay_GetSetMethod]=new TGetMsgHandlerNum(function(){return r.getPlay()}),r.fGetMsgHandlerMap[krate_GetSetMethod]=new TGetMsgHandlerNum(function(){return r.getRate()}),r.fGetMsgHandlerMap[kvolume_GetSetMethod]=new TGetMsgHandlerNum(function(){return r.getVolume()}),r.fGetMsgHandlerMap[kvdate_GetSetMethod]=new TGetMsgHandlerTime(function(){return r.getVDate()}),r.fGetMsgHandlerMap[kmls_GetMethod]=new TGetMsgHandlerNum(function(){return r.getMLS()}),r.fGetMsgHandlerMap[kvduration_GetMethod]=new TGetMsgHandlerNum(function(){return r.getVDuration()}),r}return __extends(e,t),e.prototype.cleanup=function(){this.fModified=!1},e.prototype.modified=function(){return this.fModified},e.prototype.modify=function(){this.fModified=!0},e.prototype.colorAble=function(){},e.prototype.getFile=function(){return this.fFile},e.prototype.set=function(e){var n=t.prototype.set.call(this,e);if(n&eMsgStatus.kProcessed+eMsgStatus.kProcessedNoChange)return n;if(3==e.size()){var r=e.paramStr(2);if(!r.correct)return eMsgStatus.kBadParameters;this.fFile=r.value,this.newData(!0),n=eMsgStatus.kProcessed}else n=eMsgStatus.kBadParameters;return n},e.prototype.getSet=function(){return new IMessage(this.getOSCAddress(),[kset_SetMethod,this.fTypeString,"'"+this.getFile()+"'"])},e.prototype.getPlay=function(){return this.fPlay},e.prototype.getVolume=function(){return this.fVolume},e.prototype.getRate=function(){return this.fRate},e.prototype.getVDate=function(){return this.fVDate},e.prototype.getMLS=function(){return this.fMLS},e.prototype.getVDuration=function(){return this.fVDuration},e.prototype.setPlay=function(t){this.fPlay=t,this.modify()},e.prototype.setVolume=function(t){this.fVolume=t,this.modify()},e.prototype.setRate=function(t){this.fRate=t,this.modify()},e.prototype.setVDate=function(t){return 0==t.getDenominator()?void(this.fVDate=new Fraction(this.fVDate.getNumerator()/1e3,1)):void(this.fVDate!=t&&(this.fVDate=t,this.modify()))},e}(IObject),VHtmlVideoView=function(t){function e(e){var n=this,r=document.createElement("video");return n=t.call(this,r,e)||this,n.fVideo=r,n.fFile="",n.getHtml().className="inscore-video",n}return __extends(e,t),e.prototype.updateView=function(e){var n=e;(this.fFile!=n.getFile()||""==this.fFile)&&(this.fVideo.src=n.getFile(),this.fFile=n.getFile()),t.prototype.updateView.call(this,e),this.updateVideoControl(n)},e.prototype.setShadow=function(t){var e=new IColor(t.slice(2,6));this.getHtml().style.filter="drop-shadow("+e.getCSSRGBAString()+" "+t[0]+"px "+t[1]+"px "+t[6]+"px)"},e.prototype.getAutoElement=function(){return this.fVideo},e.prototype.updateVideoControl=function(t){t.modified()&&(t.fPlay?this.fVideo.play():this.fVideo.pause(),this.fVideo.volume=t.fVolume,this.fVideo.playbackRate=t.fRate,this.fVideo.currentTime+=t.fVDate.getNumerator()/t.fVDate.getDenominator(),t.fMLS=1e3*this.fVideo.duration,t.fVDuration=this.fVideo.duration/this.fVideo.playbackRate)},e.prototype.getClientSize=function(t){return this.fClientWidth||(this.fClientWidth=this.fVideo.videoWidth,this.fClientHeight=this.fVideo.videoHeight),{w:this.fClientWidth,h:this.fClientHeight}},e}(VHtmlAutoSize),HtmlViewFactory=function(){function t(){}return t.prototype.create=function(t,e,n){switch(t){case kEllipseType:return new VHtmlEllipseView(e);case kRectType:return new VHtmlRectView(e);case kCurveType:return new VHtmlCurveView(e);case kLineType:return new VHtmlLineView(e);case kPolygonType:return new VHtmlPolygonView(e);case kTextType:case kTextfType:return new VHtmlTextView(e);case kHtmlType:return new VHtmlHtmlView(e);case kSceneType:return new VHtmlSceneView(n);case kSvgfType:return new VHtmlSVGfView(e);case kImgType:return new VHtmlImageView(e);case kArcType:return new VHtmlArcView(e);case kVideoType:return new VHtmlVideoView(e);case kGuidoCodeType:return new VHtmlGMNView(e);case kGuidoPianoRollType:return new VHtmlPianoRollView(e);case kSvgType:return new VHtmlSvgView(e);default:return null}},t}(),kCLine=1,kCSharpLine=2,kDLine=4,kDSharpLine=8,kELine=16,kFLine=32,kFSharpLine=64,kGLine=128,kGSharpLine=256,kALine=512,kASharpLine=1024,kBLine=2048,kAutoLines=0,kNoLine=-1,IGuidoPianoRoll=function(t){function e(n,r){var o=t.call(this,n,r)||this;return e.fEngine||(e.fEngine=new Module.GUIDOPianoRollAdapter),o.fTypeString=kGuidoPianoRollType,o.fKeyboard=!1,o.fAutoVoiceColor=!1,o.fMeasureBars=!1,o.fPitchLines=kAutoLines,o.setWidth(1),o.setHeight(.5),t.prototype.setHandlers.call(o),o.fMsgHandlerMap[kwidth_GetSetMethod]=new TMsgHandlerNum(function(t){o.setWidth(t)}),o.fMsgHandlerMap[kheight_GetSetMethod]=new TMsgHandlerNum(function(t){o.setHeight(t)}),o}return __extends(e,t),e.prototype.getPRollMap=function(t){this.guidoMap2inscoreMap(IGuidoCode.fGuidoMap.getPianoRollMap(t,1,1))},e.prototype.AR2SVG=function(t){var n=e.fEngine.ar2PianoRoll(PianoRollType.kSimplePianoRoll,t),r=e.fEngine.svgExport(n,1,1);return this.getPRollMap(n),e.fEngine.destroyPianoRoll(n),r},e}(IGuidoCode),IScene=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.fTypeString=kSceneType,r.fAbsolutePos=!1,r.fPosition.setWidth(1),r.fPosition.setHeight(1),r}return __extends(e,t),e.prototype.setHandlers=function(){var e=this;t.prototype.setHandlers.call(this),this.fMsgHandlerMap[knew_SetMethod]=new TMsgHandlerVoid(function(){e.newScene()}),this.fMsgHandlerMap.redraw=new TMsgHandlerVoid(function(){e.redraw()}),this.fMsgHandlerMap[kposition_GetSetMethod]=new TMsgHandlerText(function(t){e.setPositionStyle(t)}),this.fMsgHandlerMap[kfullscreen_GetSetMethod]=new TMsgHandlerNum(function(t){e.setFullScreen(t)}),this.fGetMsgHandlerMap[kfullscreen_GetSetMethod]=new TGetMsgHandlerNum(function(){return e.getFullScreen()}),this.fGetMsgHandlerMap[kposition_GetSetMethod]=new TGetMsgHandlerText(function(){return e.getPositionStyle()})},e.prototype.getPositionStyle=function(){return this.fAbsolutePos?e.kAbsolute:e.kRelative},e.prototype.setPositionStyle=function(t){this.fAbsolutePos=t===e.kAbsolute,this.fPosition.modify()},e.prototype.getRScale=function(){return this.fPosition.getScale()},e.prototype.getRSizeAsScale=function(){return Math.min(this.fPosition.getWidth(),this.fPosition.getHeight())/2},e.prototype.timeAble=function(){},e.prototype.redraw=function(){this.posPropagate()},e.prototype.newScene=function(){},e.prototype.getScene=function(){return this},e.prototype.getSet=function(){return new IMessage(this.getOSCAddress(),knew_SetMethod)},e.prototype.getFullScreen=function(){return this.fFullScreen?1:0},e.prototype.setFullScreen=function(t){this.fFullScreen=t?!0:!1},e}(IRectShape);IScene.kAbsolute="absolute",IScene.kRelative="relative";var TSyncNode=function(){function t(t,e,n,r){this.fSlave=t,this.fMaster=e,this.fInfos=new TSyncInfo,this.fViews=r,this.fInfos.update(n)}return t.prototype.update=function(t){
this.fInfos.update(t)},t.prototype.toString=function(){return this.fSlave.getName()+" "+this.fMaster.getName()+" "+this.fInfos},t.prototype.toArray=function(){var t=[this.fSlave.getName(),this.fMaster.getName()];return t=t.concat(this.fInfos.toArray())},t}(),ISync=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.fTypeString=kSyncType,r.fSyncList=[],r}return __extends(e,t),e.prototype.findSync=function(t,e){var n=[],r=function(r){e(r)===t&&n.push(r)};if(Tools.regexp(t)){var o=new OSCRegexp(t);r=function(t){o.match(e(t))&&n.push(t)}}return this.fSyncList.forEach(r),n},e.prototype.findSyncBySlaveName=function(t){return this.findSync(t,function(t){return t.fSlave.getName()})},e.prototype.findSyncByMasterName=function(t){return this.findSync(t,function(t){return t.fMaster.getName()})},e.prototype.findSyncNodes=function(t,e){var n=[],r=this.findSyncBySlaveName(t);if(!r.length)return n;var o=function(t){return t===e};if(Tools.regexp(e)){var i=new OSCRegexp(e);o=function(t){return i.match(t)}}return r.forEach(function(t){o(t.fMaster.getName())&&n.push(t)}),n},e.prototype.restoreDefaultView=function(t){var e=IObjectFactory.createViews(t,t.getParent().getViews());e.forEach(function(e){t.setView(e)}),t.subModPropagate(t.getParent()),t.allModified()},e.prototype.removeSync=function(t){this.clearName(t.getName())},e.prototype.clearName=function(t){var e=this,n=this.findSyncBySlaveName(t);return n.forEach(function(t){var n=e.fSyncList.indexOf(t);n>=0&&(t.fViews.forEach(function(e){t.fSlave.removeView(e)}),t.fSlave.getViews().length||e.restoreDefaultView(t.fSlave),e.fSyncList.splice(n,1))}),eMsgStatus.kProcessedNoChange},e.prototype.updateSync=function(t,e){t.update(e);var n=t.fSlave;n.subModPropagate(t.fMaster),n.posModified()},e.prototype.createSync=function(t,e,n){var r=this.findSyncBySlaveName(t.getName()).length;r||t.removeViews();var o=IObjectFactory.createViews(t,e.getViews()),i=new TSyncNode(t,e,n,o);this.fSyncList.push(i),o.forEach(function(n){t.addView(n),n.setPositionHandler(function(){return t.getSlavePosition(e,i.fInfos)})}),t.subModPropagate(e),t.allModified()},e.prototype.getOne=function(t){var e=this,n=[],r=this.findSyncBySlaveName(t);return r.forEach(function(t){n.push(new IMessage(e.getOSCAddress(),t.toArray()))}),n},e.prototype.getAll=function(){var t=this,e=[];return this.fSyncList.forEach(function(n){e.push(new IMessage(t.getOSCAddress(),n.toArray()))}),e},e.prototype.setSync=function(t){var e=this,n=t.paramStr(0),r=t.paramStr(1);if(!n.correct||!r.correct)return eMsgStatus.kBadParameters;var o=new TSyncInfo;if(!o.set(t))return eMsgStatus.kBadParameters;var i=this.findSyncNodes(n.value,r.value);if(i.length)i.forEach(function(t){e.updateSync(t,o)});else{var s=this.fParent.find(n.value);if(!s.length)return ITLError.write(n.value+": no such object!"),eMsgStatus.kBadParameters;var a=this.fParent.find(r.value);if(!a.length)return ITLError.write(r.value+": no such object!"),eMsgStatus.kBadParameters;for(var u=0;u<s.length;u++)for(var f=0;f<a.length;f++)s[u].fTypeString!=kSyncType&&a[f].fTypeString!=kSyncType&&this.createSync(s[u],a[f],o)}return eMsgStatus.kProcessedNoChange},e.prototype.getCall=function(t){var e=t.size();if(1==e)return this.getAll();for(var n=[],r=1;e>r;r++){var o=t.paramStr(r);if(o.correct){var i=this.getOne(o.value);i&&i.forEach(function(t){n.push(t)})}}return n},e.prototype.execute=function(t){var e=t.size();if(!e)return eMsgStatus.kBadParameters;var n=t.paramStr(0);if(!n.correct)return eMsgStatus.kBadParameters;var r=n.value==kget_SetMethod;return r?this.get(t):1==e?this.clearName(n.value):this.setSync(t)},e.prototype.delNotify=function(t){for(var e=function(){var t=n.fSyncList[r];t.fSlave.getDeleted()?n.fSyncList.splice(r,1):t.fMaster.getDeleted()?(t.fViews.forEach(function(e){t.fSlave.removeView(e)}),t.fSlave.getViews().length||n.restoreDefaultView(t.fSlave),n.fSyncList.splice(r,1)):r++},n=this,r=0;r<this.fSyncList.length;)e()},e.prototype.createStaticNodes=function(){},e}(IObject),ITextf=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.fTypeString=kTextfType,r}return __extends(e,t),e.prototype.setHandlers=function(){var e=this;t.prototype.setHandlers.call(this),this.fGetMsgHandlerMap[""]=new TGetMsgHandlerText(function(){return e.getTextFile()})},e.prototype.getTextFile=function(){return this.fTextFile},e.prototype.setTextFile=function(t){this.fTextFile=t},e.prototype.set=function(e){console.log("ITextf set: "+e);var n=t.prototype.set.call(this,e);if(n!=eMsgStatus.kProcessed)return n;var r=e.size();if(3==r){var o=e.paramStr(2);if(o.correct){this.fTextFile=o.value;var i=new FileReader,s=new Blob([o.value]);console.log("readAsText: "+s),i.onloadend=this._setText(i),i.readAsText(s),n=eMsgStatus.kProcessed}else n=eMsgStatus.kBadParameters}return n},e.prototype._setText=function(t){var e=this;return function(){console.log("_setText: "+t.result),e.setText(t.result)}},e.prototype.getSet=function(){var t=[kset_SetMethod,this.fTypeString];return new IMessage(this.getOSCAddress(),t.concat("'"+this.fTextFile+"'"))},e}(IText),IWebSocket=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.fTypeString=kWebSocketType,t.prototype.setHandlers.call(r),r}return __extends(e,t),e.prototype.setControler=function(t){this.fWebServer=t},e.prototype.getPort=function(){return this.fPort},e.prototype.getFrequency=function(){return this.fFrequency},e.prototype.running=function(){return this.fWebServer.running()},e.prototype.status=function(){return this.running()?"running":"stopped"},e.prototype.start=function(t){return this.fWebServer.start(t)},e.prototype.set=function(e){var n=t.prototype.set.call(this,e);if(n&eMsgStatus.kProcessed+eMsgStatus.kProcessedNoChange)return n;if(3!=e.size())return eMsgStatus.kBadParameters;var r=-1,o=-1,i=e.paramNum(3),s=e.paramNum(4);if(!i.correct||!s.correct)return eMsgStatus.kBadParameters;if(!i.value||!s.value)return eMsgStatus.kBadParameters;var a=!1;return o!=this.fFrequency&&(this.fFrequency=o,a=!0),r!=this.fPort&&(this.fPort=r,a=!0),a&&!this.start(r)?eMsgStatus.kCreateFailure:eMsgStatus.kProcessed},e.prototype.getSet=function(){return new IMessage(this.getOSCAddress(),[kset_SetMethod,this.fTypeString,this.fPort,this.fFrequency])},e}(IObject),IObjectFactoryImpl=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.fViewFactory=new HtmlViewFactory,e}return __extends(e,t),e.prototype.createView=function(t){var e=this.fViewFactory.create(t.getTypeString(),null,t.getName());return e.setPositionHandler(function(){return t.getPosition()}),e},e.prototype.createViews=function(t,e){var n=[];if(gCreateView)for(var r=0;r<e.length;r++){var o=this.fViewFactory.create(t.getTypeString(),e[r],t.getName());o.setPositionHandler(function(){return t.getPosition()}),n.push(o)}return n},e.prototype.createObj=function(t,e,n){var r;switch(e){case kDebugType:return new IDebug(t,n);case kSyncType:return new ISync(t,n);case kSceneType:return r=new IScene(t,n),r.setView(this.createView(r)),r;case kEllipseType:r=new IEllipse(t,n);break;case kRectType:r=new IRect(t,n);break;case kCurveType:r=new ICurve(t,n);break;case kLineType:r=new ILine(t,n);break;case kGuidoCodeType:r=new IGuidoCode(t,n);break;case kGuidoPianoRollType:r=new IGuidoPianoRoll(t,n);break;case kPolygonType:r=new IPolygon(t,n);break;case kTextType:r=new IText(t,n);break;case kTextfType:r=new ITextf(t,n);break;case kHtmlType:r=new IHtml(t,n);break;case kImgType:r=new IImage(t,n);break;case kArcType:r=new IArc(t,n);break;case kVideoType:r=new IVideo(t,n);break;case kSvgType:r=new ISVG(t,n);break;case kSvgfType:r=new ISVGf(t,n);break;case kWebSocketType:r=new IWebSocket(t,n);break;default:return ITLError.write("IObjectFactory: unknown object type: "+e),null}return r.addViews(this.createViews(r,n.getViews())),r},e}(IObjectFactoryInterface);IObjectFactory=new IObjectFactoryImpl;var IProxyImpl=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.execute=function(t,e,n){if(Tools.regexp(e))return{status:eMsgStatus.kBadAddress};var r,o=t.message();if(!o.correct)return{status:eMsgStatus.kBadParameters};if(n&&"IAppl"==n.getTypeString()){if("new"!=o.value)return{status:eMsgStatus.kBadAddress};if(1!=t.size())return{status:eMsgStatus.kBadParameters};r="scene"}else{if("set"!=o.value)return{status:eMsgStatus.kBadAddress};if(t.size()<2)return{status:eMsgStatus.kBadParameters};var i=t.paramStr(1);if(!i.correct)return{status:eMsgStatus.kBadParameters};r=i.value}var s=IObjectFactory.createObj(e,r,n);if(s){var a=s.execute(t);return a&eMsgStatus.kProcessed+eMsgStatus.kProcessedNoChange?(n.addChild(s),s.setState(eObjState.kModified),{status:eMsgStatus.kProcessed,obj:s}):{status:a}}return{status:eMsgStatus.kCreateFailure}},e}(IProxyInterface);IProxy=new IProxyImpl;var VHtmlLog=function(t){function e(){var e=t.call(this)||this;return e.fPreviousX=-1,e.fPreviousY=-1,e.fPreviousOX=-1,e.fPreviousOY=-1,e}return __extends(e,t),e.prototype.updateView=function(t){if(t.fPosition.getVisible()){var e=t.getPosition(),n=t.getSize(),r=(this.fPreviousOX<0?!0:e.x!=this.fPreviousOX)||(this.fPreviousOY<0?!0:e.y!=this.fPreviousOY);if(this.fPreviousOX=e.x,this.fPreviousOY=e.y,this.checkwindow(t)){if(this.fWindow.focus(),t.fPosition.modified()&&(this.fWindow.resizeTo(this.relative2SceneWidth(n.w),this.relative2SceneHeight(n.h)),r)){var o=this.relative2SceneY(e.y-n.h/2),i=this.relative2SceneX(e.x-n.w/2);this.fWindow.moveTo(i,o)}this.writelog(t)}}else this.fWindow&&(this.fWindow.close(),this.close(t))},e.prototype.setPositionHandler=function(t){},e.prototype.writelog=function(t){t.cleared()&&(this.fWindow.document.body.innerHTML="");for(var e=t.content(),n=0;n<e.length;n++)this.fWindow.document.write(e[n]+"<br />\n"),this.fWindow.window.scrollBy(0,50);t.done()},e.prototype.checkwindowpos=function(t){var e=t.getSize(),n=this.fWindow.screenX;n!=this.fPreviousX&&t.fPosition.setXPos(this.scene2RelativeX(n)+e.w/2);var r=this.fWindow.screenY;r!=this.fPreviousY&&t.fPosition.setYPos(this.scene2RelativeY(r)+e.h/2),this.fPreviousX=n,this.fPreviousY=r},e.prototype.close=function(t){this.checkwindowpos(t),this.fWindow=void 0},e.prototype.closeHandler=function(t){this.close(t),t.fPosition.setVisible(0)},e.prototype._close=function(t){var e=this;return function(){return e.closeHandler(t)}},e.prototype.getCurrentStyleSheets=function(){var t="";for(var e in document.styleSheets){var n=document.styleSheets[e].href;n&&(t+="<link href='"+n+"' rel='stylesheet'>\n")}return t},e.prototype.checkwindow=function(t){if(!this.fWindow){var e="menubar=no, titlebar=no, status=no, directories=no, location=no",n=this.getCurrentStyleSheets();return this.fWindow=window.open("",t.getOSCAddress(),e),this.fWindow?(this.fWindow.document.write("<head><title>"+t.getOSCAddress()+"</title>\n"+n+"</head>"),this.fWindow.document.write("<body class='inscore-log'></body>"),this.fWindow.addEventListener("resize",this._resizeLog(t)),this.fWindow.addEventListener("unload",this._close(t)),!0):!1}return this.checkwindowpos(t),this.fWindow.focus(),!0},e.prototype.resizeLog=function(t){var e=this.scene2RelativeWidth(this.fWindow.outerWidth),n=this.scene2RelativeHeight(this.fWindow.outerHeight);t.fPosition.setWidth(e),t.fPosition.setHeight(n)},e.prototype._resizeLog=function(t){var e=this;return function(){return e.resizeLog(t)}},e.prototype.updateObjectSize=function(t){},e.prototype.remove=function(){},e.prototype.relative2SceneX=function(t){var e=screen.availWidth/2;return e+e*t},e.prototype.relative2SceneY=function(t){var e=screen.availHeight/2;return e+e*t},e.prototype.relative2SceneWidth=function(t){return screen.availWidth*t/2},e.prototype.relative2SceneHeight=function(t){return screen.availHeight*t/2},e.prototype.scene2RelativeWidth=function(t){return 2*t/screen.availWidth},e.prototype.scene2RelativeHeight=function(t){return 2*t/screen.availHeight},e.prototype.scene2RelativeX=function(t){var e=screen.availWidth/2;return(t-e)/e},e.prototype.scene2RelativeY=function(t){var e=screen.availHeight/2;return(t-e)/e},e.prototype.initialize=function(t){},e}(VObjectView),IStaticNode=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.fTypeString="static",r}return __extends(e,t),e.prototype.del=function(){},e.prototype.getSet=function(){var t;return t},e}(IObject),IApplLog=function(t){function e(e,n){var r=t.call(this,e,n)||this;return r.fTypeString="log",r.fLog=new Array,r.fClear=!1,r.fPosition.setVisible(0),r.fPosition.setWidth(.8),r.fPosition.setHeight(.5),r.setView(new VHtmlLog),r}return __extends(e,t),e.prototype.setHandlers=function(){var t=this;this.fMsgHandlerMap[kget_SetMethod]=new TMethodHandler(function(e){return t.get(e)}),this.fMsgHandlerMap[kclear_SetMethod]=new TMsgHandlerVoid(function(){t.clear()}),this.fMsgHandlerMap[kwrite_SetMethod]=new TMethodHandler(function(e){return t.write(e)}),this.fMsgHandlerMap[kforeground_SetMethod]=new TMsgHandlerVoid(function(){t.foreground()}),this.fMsgHandlerMap[kwrap_GetSetMethod]=new TMsgHandlerNum(function(e){t.wrap(e)}),this.fMsgHandlerMap[ksave_SetMethod]=new TMsgHandlerText(function(e){t.savelog(e)}),this.fMsgHandlerMap[kx_GetSetMethod]=new TMsgHandlerNum(function(e){t.fPosition.setXPos(e)}),this.fMsgHandlerMap[ky_GetSetMethod]=new TMsgHandlerNum(function(e){t.fPosition.setYPos(e)}),this.fMsgHandlerMap[kwidth_GetSetMethod]=new TMsgHandlerNum(function(e){t.setWidth(e)}),this.fMsgHandlerMap[kheight_GetSetMethod]=new TMsgHandlerNum(function(e){t.setHeight(e)}),this.fMsgHandlerMap[kshow_GetSetMethod]=new TMsgHandlerNum(function(e){t.fPosition.setVisible(e)}),this.fMsgHandlerMap[kscale_GetSetMethod]=new TMethodHandler(function(t){return eMsgStatus.kProcessedNoChange}),this.fGetMsgHandlerMap[kx_GetSetMethod]=new TGetMsgHandlerNum(function(){return t.fPosition.getXPos()}),this.fGetMsgHandlerMap[ky_GetSetMethod]=new TGetMsgHandlerNum(function(){return t.fPosition.getYPos()}),this.fGetMsgHandlerMap[kwidth_GetSetMethod]=new TGetMsgHandlerNum(function(){return t.fPosition.getWidth()}),this.fGetMsgHandlerMap[kheight_GetSetMethod]=new TGetMsgHandlerNum(function(){return t.fPosition.getHeight()}),this.fGetMsgHandlerMap[kshow_GetSetMethod]=new TGetMsgHandlerNum(function(){return t.fPosition.getVisible()})},e.prototype.content=function(){return this.fLog},e.prototype.done=function(){this.fLog=[],this.fClear=!1},e.prototype.cleared=function(){return this.fClear},e.prototype.clear=function(){this.fClear=!0,this.fLog=[]},e.prototype.write=function(t){for(var e=t.params(),n="",r=1;r<e.length;r++)n+=e[r].toString()+" ";return this.fLog.push(n),eMsgStatus.kProcessed},e.prototype.foreground=function(){},e.prototype.wrap=function(t){},e.prototype.savelog=function(t){},e}(IStaticNode),IAppl=function(t){function e(){var e=t.call(this,"ITL")||this;return e.fTypeString=kApplType,e.fReceivedMsgs=0,e.fRate=kDefaultRate,e}return __extends(e,t),e.prototype.createStaticNodes=function(){var t=new IApplLog("log",this);this.addChild(t)},e.prototype.setHandlers=function(){var t=this;this.eventAble(),this.fMsgHandlerMap[kget_SetMethod]=new TMethodHandler(function(e){return t.get(e)}),this.fMsgHandlerMap[krate_GetSetMethod]=new TMsgHandlerNum(function(e){t.setRate(e)}),this.fGetMsgHandlerMap[krate_GetSetMethod]=new TGetMsgHandlerNum(function(){return t.getRate()})},e.prototype.getAppl=function(){return this},e.prototype.getSet=function(){var t;return t},e.prototype.getOSCAddress=function(){return"/ITL"},e.prototype.getRate=function(){return this.fRate},e.prototype.setRate=function(t){this.fRate=t},e.prototype.processMsg=function(e,n,r){this.fReceivedMsgs++;var o=eMsgStatus.kBadAddress,i=e,s=n;return s.length?o=t.prototype.processMsg.call(this,i,s,r):this.match(i)&&(o=this.execute(r),o&eMsgStatus.kProcessed&&this.setState(eObjState.kModified)),o},e}(IObject),ViewUpdater=function(){function t(){}return t.update=function(t){if(!t.getDeleted()){var e=t.getState();if(e&eObjState.kNewObject+eObjState.kModified){var n=t.getViews();n.forEach(function(e){e.updateView(t)})}if(e&eObjState.kSubModified)for(var r=t.getSubNodes(),o=0;o<r.length;o++)this.update(r[o])}},t}(),ModelUpdater=function(){function t(t){this.fRoot=t}return t.prototype.update=function(t){for(var e=t.length,n=0;e>n;n++){var r=t[n];INScore.checkStatus(this.fRoot.process(r),r)}},t}(),IGlue=function(){function t(){this.fAppl=new IAppl,this.fStack=new Array,this.fModelUpdater=new ModelUpdater(this.fAppl),this.fCurrentTime=0}return t.prototype.getStack=function(){return this.fStack},t.prototype.popStack=function(){return this.fStack.shift()},t.prototype.pushStack=function(t){this.fStack.push(t)},t.prototype.initEventHandlers=function(){window.addEventListener("resize",inscore_resizeDocument)},t.prototype.start=function(t,e){var n="/ITL/"+t;INScore.postMessage(n,["new"]),INScore.postMessage(n,["position",e]),gCreateView&&(this.fTimer=setTimeout(this._timetask(),this.fAppl.getRate())),window.onbeforeunload=function(){INScore.postMessage("/ITL/log",["show",0])}},t.prototype.stop=function(){INScore.postMessage("/ITL",["quit"]),clearTimeout(this.fTimer)},t.prototype.getRoot=function(){return this.fAppl},t.prototype.timetask=function(){var t=new Date,e=t.getTime();this.fCurrentTime&&(gINScoreRealRate=e-this.fCurrentTime),this.fCurrentTime=e;var n=this.fStack;this.fStack=[],this.fModelUpdater.update(n),ViewUpdater.update(this.fAppl),IObject.timeTaskCleanup(this.fAppl),this.fTimer=setTimeout(this._timetask(),this.fAppl.getRate())},t.prototype._timetask=function(){var t=this;return function(){return t.timetask()}},t}(),INScoreParser=function(){function t(t){}function e(t){if("string"==typeof t)return t;if("object"==typeof t){for(var n="",r=0;r<t.length;r++)n+=e(t[r])+"\n";return n}return""}function n(t){t.length&&INScoreParser.parse(t)}function o(t){var e=D.vars;for(var n in e)if(n===t)return e[n];return console.log("Warning! variable $"+t+" is undefined"),"$"+t}function i(){var t=D.vars,e="";for(var n in t)e+="var "+n+"="+t[n][0].toString()+";\n";return e}function s(t){if(O)return"";var e=this;return this.print=function(t){console.log(t)},e.eval(i()+t)}function s(t){return""}function a(t,e,n){this.ip=t,this.port=e,this.osc=n,this.toString=function(){return this.ip+(this.port?":"+this.port:"")+this.osc}}function u(t,e){this.address=t,this.params=e,this.toString=function(){return this.address.toString()+" "+this.params.toString()}}function f(){this.yy={}}var h=function(t,e,n,r){for(n=n||{},r=t.length;r--;n[t[r]]=e);return n},c=[1,6],l=[1,9],p=[1,10],d=[1,14],g=[1,16],y=[1,17],S=[1,13],M=[1,9,10,21,24,27,28,31],m=[6,16,19,20],v=[1,32],k=[1,26],P=[1,31],T=[1,35],H=[1,36],G=[1,34],_=[1,25],b=[1,27],E=[1,29],N=[1,30],I=[2,23],A=[6,10,13,14,16,19,20,26,28,31,32,34,35,36,37,38],x=[6,10,14,16,19,20,26,28,31,32,34,35,36,37,38],C=[1,58],R=[1,59],V=[16,19,20],B=[21,24,27,28,31],D={trace:function(){},yy:{},symbols_:{error:2,inscore:3,expr:4,message:5,ENDEXPR:6,variabledecl:7,script:8,ENDSCRIPT:9,JSCRIPT:10,address:11,params:12,eval:13,LEFTPAR:14,messagelist:15,RIGHTPAR:16,variable:17,messagelistseparator:18,COMMA:19,COLON:20,OSCADDRESS:21,relativeaddress:22,urlprefix:23,POINT:24,hostname:25,UINT:26,IPNUM:27,HOSTNAME:28,varname:29,identifier:30,IDENTIFIER:31,REGEXP:32,param:33,VARSTART:34,INT:35,FLOAT:36,STRING:37,EXPRESSION:38,EQUAL:39,$accept:0,$end:1},terminals_:{2:"error",6:"ENDEXPR",9:"ENDSCRIPT",10:"JSCRIPT",13:"eval",14:"LEFTPAR",16:"RIGHTPAR",19:"COMMA",20:"COLON",21:"OSCADDRESS",24:"POINT",26:"UINT",27:"IPNUM",28:"HOSTNAME",31:"IDENTIFIER",32:"REGEXP",34:"VARSTART",35:"INT",36:"FLOAT",37:"STRING",38:"EXPRESSION",39:"EQUAL"},productions_:[0,[3,1],[3,2],[4,2],[4,2],[4,1],[4,1],[8,1],[5,1],[5,2],[5,5],[5,3],[15,1],[15,3],[18,1],[18,1],[11,1],[11,1],[11,2],[22,2],[23,3],[23,3],[25,1],[25,1],[30,1],[30,1],[12,1],[12,1],[12,2],[12,2],[17,2],[17,2],[17,4],[33,1],[33,1],[33,1],[33,1],[33,1],[33,1],[33,1],[33,3],[33,1],[7,3],[29,1]],performAction:function(r,i,f,h,c,l,p){var d=l.length-1;switch(c){case 3:D.msgs.push(l[d-1]);break;case 4:case 5:break;case 6:return t("expr ENDSCRIPT "),!0;case 7:l[d].length&&n(e(s(l[d])));break;case 8:this.$=new u(l[d],new Array);break;case 9:this.$=new u(l[d-1],l[d]),t(this.$.toString());break;case 10:l[d-1].unshift(l[d-3]),this.$=new u(l[d-4],l[d-1]);break;case 11:l[d].unshift(l[d-1]),this.$=new u(l[d-2],l[d]);break;case 12:this.$=new Array,this.$.push(l[d]);break;case 13:l[d-2].push(l[d]),this.$=l[d-2];break;case 16:case 17:this.$=new a("",0,l[d]);break;case 18:l[d-1].osc=l[d],this.$=l[d-1];break;case 19:this.$=l[d-1]+l[d];break;case 20:case 21:this.$=new a(l[d-2],parseInt(l[d]),"");break;case 22:case 23:case 24:case 25:case 36:case 37:case 38:case 39:case 41:case 43:this.$=l[d];break;case 26:case 27:this.$=[l[d]];break;case 28:this.$=l[d-1].concat(l[d]);break;case 29:l[d-1].push(l[d]),this.$=l[d-1];break;case 30:this.$=o(l[d]);break;case 31:this.$="$"+l[d];break;case 32:this.$=new Array(l[d-1]);break;case 33:case 34:this.$=parseInt(l[d]);break;case 35:this.$=parseFloat(l[d]);break;case 40:this.$=l[d-1];break;case 42:t("variabledecl: "+l[d-2]+" = "+l[d]),D.vars[l[d-2]]=l[d]}},table:[{3:1,4:2,5:3,7:4,8:5,9:c,10:l,11:7,21:p,22:11,23:12,24:d,25:15,27:g,28:y,29:8,31:S},{1:[3],4:18,5:3,7:4,8:5,9:c,10:l,11:7,21:p,22:11,23:12,24:d,25:15,27:g,28:y,29:8,31:S},h(M,[2,1]),{6:[1,19]},{6:[1,20]},h(M,[2,5]),h(M,[2,6]),h(m,[2,8],{12:21,33:23,17:24,30:28,8:33,10:l,13:[1,22],14:v,26:k,28:P,31:T,32:H,34:G,35:_,36:b,37:E,38:N}),{20:I,39:[1,37]},h([1,6,9,10,14,16,19,20,21,24,26,27,28,31,32,34,35,36,37,38],[2,7]),h(A,[2,16]),h(A,[2,17]),{21:[1,38]},h([6,10,14,16,19,20,26,28,31,32,34,35,36,37,38,39],[2,43]),{21:[1,39]},{20:[1,40]},{20:[1,41]},{20:[2,22]},h(M,[2,2]),h(M,[2,3]),h(M,[2,4]),h(m,[2,9],{30:28,8:33,17:42,33:43,10:l,14:v,26:k,28:P,31:T,32:H,34:G,35:_,36:b,37:E,38:N}),{14:[1,44],17:45,34:G},h(x,[2,26]),h(x,[2,27]),h(x,[2,33]),h(x,[2,34]),h(x,[2,35]),h(x,[2,36]),h(x,[2,37]),h(x,[2,38]),h(x,[2,39]),{5:47,11:7,15:46,21:p,22:11,23:12,24:d,25:15,27:g,28:y,29:48,31:S},h(x,[2,41]),{14:[1,51],26:[1,50],29:49,31:S},h(x,[2,24]),h(x,[2,25]),{8:33,10:l,12:52,14:v,17:24,26:k,28:P,30:28,31:T,32:H,33:23,34:G,35:_,36:b,37:E,38:N},h(A,[2,18]),h(A,[2,19]),{26:[1,53]},{26:[1,54]},h(x,[2,28]),h(x,[2,29]),{5:47,11:7,15:55,21:p,22:11,23:12,24:d,25:15,27:g,28:y,29:48,31:S},h(m,[2,11]),{16:[1,56],18:57,19:C,20:R},h(V,[2,12]),{20:I},h(x,[2,30]),h(x,[2,31]),{5:60,11:7,21:p,22:11,23:12,24:d,25:15,27:g,28:y,29:48,31:S},{6:[2,42],8:33,10:l,14:v,17:42,26:k,28:P,30:28,31:T,32:H,33:43,34:G,35:_,36:b,37:E,38:N},{21:[2,20]},{21:[2,21]},{16:[1,61],18:57,19:C,20:R},h(x,[2,40]),{5:62,11:7,21:p,22:11,23:12,24:d,25:15,27:g,28:y,29:48,31:S},h(B,[2,14]),h(B,[2,15]),{16:[1,63]},h(m,[2,10]),h(V,[2,13]),h(x,[2,32])],defaultActions:{17:[2,22],48:[2,23],53:[2,20],54:[2,21]},parseError:function(t,e){function n(t,e){this.message=t,this.hash=e}if(!e.recoverable)throw n.prototype=Error,new n(t,e);this.trace(t)},parse:function(t){var e=this,n=[0],r=[null],o=[],i=this.table,s="",a=0,u=0,f=0,h=2,c=1,l=o.slice.call(arguments,1),p=Object.create(this.lexer),d={yy:{}};for(var g in this.yy)Object.prototype.hasOwnProperty.call(this.yy,g)&&(d.yy[g]=this.yy[g]);p.setInput(t,d.yy),d.yy.lexer=p,d.yy.parser=this,"undefined"==typeof p.yylloc&&(p.yylloc={});var y=p.yylloc;o.push(y);var S=p.options&&p.options.ranges;"function"==typeof d.yy.parseError?this.parseError=d.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;for(var M,m,v,k,w,P,T,H,G,_=function(){var t;return t=p.lex()||c,"number"!=typeof t&&(t=e.symbols_[t]||t),t},b={};;){if(v=n[n.length-1],this.defaultActions[v]?k=this.defaultActions[v]:((null===M||"undefined"==typeof M)&&(M=_()),k=i[v]&&i[v][M]),"undefined"==typeof k||!k.length||!k[0]){var E="";G=[];for(P in i[v])this.terminals_[P]&&P>h&&G.push("'"+this.terminals_[P]+"'");E=p.showPosition?"Parse error on line "+(a+1)+":\n"+p.showPosition()+"\nExpecting "+G.join(", ")+", got '"+(this.terminals_[M]||M)+"'":"Parse error on line "+(a+1)+": Unexpected "+(M==c?"end of input":"'"+(this.terminals_[M]||M)+"'"),this.parseError(E,{text:p.match,token:this.terminals_[M]||M,line:p.yylineno,loc:y,expected:G})}if(k[0]instanceof Array&&k.length>1)throw new Error("Parse Error: multiple actions possible at state: "+v+", token: "+M);switch(k[0]){case 1:n.push(M),r.push(p.yytext),o.push(p.yylloc),n.push(k[1]),M=null,m?(M=m,m=null):(u=p.yyleng,s=p.yytext,a=p.yylineno,y=p.yylloc,f>0&&f--);break;case 2:if(T=this.productions_[k[1]][1],b.$=r[r.length-T],b._$={first_line:o[o.length-(T||1)].first_line,last_line:o[o.length-1].last_line,first_column:o[o.length-(T||1)].first_column,last_column:o[o.length-1].last_column},S&&(b._$.range=[o[o.length-(T||1)].range[0],o[o.length-1].range[1]]),w=this.performAction.apply(b,[s,u,a,d.yy,k[1],r,o].concat(l)),"undefined"!=typeof w)return w;T&&(n=n.slice(0,-1*T*2),r=r.slice(0,-1*T),o=o.slice(0,-1*T)),n.push(this.productions_[k[1]][0]),r.push(b.$),o.push(b._$),H=i[n[n.length-2]][n[n.length-1]],n.push(H);break;case 3:return!0}}return!0}},O=!1;"undefined"==typeof ITLError&&(ITLError=[],ITLError.write=function(t){console.log(t)}),D.msgs=new Array,D.vars=new Array,D.get=function(){var t=D.msgs;return D.msgs=[],D.vars=[],t},D.parseError=function(t,e){ITLError.write(t)};var F=function(){var t={EOF:1,parseError:function(t,e){if(!this.yy.parser)throw new Error(t);this.yy.parser.parseError(t,e)},setInput:function(t,e){return this.yy=e||this.yy||{},this._input=t,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var t=this._input[0];this.yytext+=t,this.yyleng++,this.offset++,this.match+=t,this.matched+=t;var e=t.match(/(?:\r\n?|\n).*/g);return e?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),t},unput:function(t){var e=t.length,n=t.split(/(?:\r\n?|\n)/g);this._input=t+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-e),this.offset-=e;var r=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),n.length-1&&(this.yylineno-=n.length-1);var o=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:n?(n.length===r.length?this.yylloc.first_column:0)+r[r.length-n.length].length-n[0].length:this.yylloc.first_column-e},this.options.ranges&&(this.yylloc.range=[o[0],o[0]+this.yyleng-e]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(t){this.unput(this.match.slice(t))},pastInput:function(){var t=this.matched.substr(0,this.matched.length-this.match.length);return(t.length>20?"...":"")+t.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var t=this.match;return t.length<20&&(t+=this._input.substr(0,20-t.length)),(t.substr(0,20)+(t.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var t=this.pastInput(),e=new Array(t.length+1).join("-");return t+this.upcomingInput()+"\n"+e+"^"},test_match:function(t,e){var n,r,o;if(this.options.backtrack_lexer&&(o={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(o.yylloc.range=this.yylloc.range.slice(0))),r=t[0].match(/(?:\r\n?|\n).*/g),r&&(this.yylineno+=r.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:r?r[r.length-1].length-r[r.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],n=this.performAction.call(this,this.yy,this,e,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),n)return n;if(this._backtrack){for(var i in o)this[i]=o[i];return!1}return!1},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var t,e,n,r;this._more||(this.yytext="",this.match="");for(var o=this._currentRules(),i=0;i<o.length;i++)if(n=this._input.match(this.rules[o[i]]),n&&(!e||n[0].length>e[0].length)){if(e=n,r=i,this.options.backtrack_lexer){if(t=this.test_match(n,o[i]),t!==!1)return t;if(this._backtrack){e=!1;continue}return!1}if(!this.options.flex)break}return e?(t=this.test_match(e,o[r]),t!==!1?t:!1):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var t=this.next();return t?t:this.lex()},begin:function(t){this.conditionStack.push(t)},popState:function(){var t=this.conditionStack.length-1;return t>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(t){return t=this.conditionStack.length-1-Math.abs(t||0),t>=0?this.conditionStack[t]:"INITIAL"},pushState:function(t){this.begin(t)},stateStackSize:function(){return this.conditionStack.length},options:{flex:!0},performAction:function(t,e,n,o){function i(t){}function s(t){var e=t.length,n="";for(r=0,w=0;r<e;r++)if("\\"==t[r]){var o=t[r+1];"'"!=o&&'"'!=o&&(n+=t[r])}else n+=t[r];return n}switch(n){case 0:return 26;case 1:return 26;case 2:return 35;case 3:return 36;case 4:return 36;case 5:return 36;case 6:return i("ENDSCRIPT : "+e.yytext),9;case 7:return i("IDENTIFIER: "+e.yytext),31;case 8:return i("HOSTNAME: "+e.yytext),28;case 9:return i("IPNUM: "+e.yytext),27;case 10:return"EVAL";case 11:this.begin("DQSTR");break;case 12:return i("STRING: "+s(e.yytext)),37;case 13:this.popState();break;case 14:this.begin("QSTR");break;case 15:return i("STRING: "+s(e.yytext)),37;case 16:this.popState();break;case 17:return i("FILE STRING: "+e.yytext),37;case 18:this.begin("JSECTION");break;case 19:this.popState();break;case 20:return i("JAVASCRIPT: "+e.yytext),10;case 21:return i("REGEXP: "+e.yytext),32;case 22:return i("REGEXP: "+e.yytext),32;case 23:return i("REGEXP: "+e.yytext),32;case 24:this.more(),this.begin("EXPRSECTION");break;case 25:if(this.more(),this.popState(),"INITIAL"==this.topState())return i("EXPRESSION "+e.yytext),38;break;case 26:this.more();break;case 27:this.begin("EXPRSECTION"),this.more();break;case 28:this.more(),this.begin("OSCSECTION");break;case 29:this.more();break;case 30:this.more();break;case 31:this.more();break;case 32:this.more();break;case 33:this.more();break;case 34:return i("OSCADDRESS "+e.yytext),this.popState(),e.yytext=e.yytext.substring(0,e.yytext.length-1),21;case 35:return 39;case 36:return 6;case 37:return 34;case 38:return 20;case 39:return 19;case 40:return 24;case 41:return 14;case 42:return 16;case 43:i("COMMENTLINE: "+e.yytext);break;case 44:i("COMMENTLINE: "+e.yytext);break;case 45:break;case 46:i("BEGIN NESTED COMMENT"),this.begin("COMMENT");break;case 47:i("END COMMENT"),this.popState();break;case 48:i("BEGIN COMMENT"),this.begin("COMMENT");
break;case 49:break;case 50:break;case 51:return 9;case 52:return i("ERR: "+e.yytext),"ERR";case 53:console.log(e.yytext)}},rules:[/^(?:([0-9])+)/,/^(?:\+([0-9])+)/,/^(?:-([0-9])+)/,/^(?:[+-]?([0-9])+\.([0-9])*)/,/^(?:[+-]?([0-9])+\.([0-9])+e[-+]?([0-9])+)/,/^(?:[+-]?([0-9])+e[-+]?([0-9])+)/,/^(?:__END__)/,/^(?:([_a-zA-Z])([_a-zA-Z0-9])*)/,/^(?:(([-a-zA-Z0-9])(([-a-zA-Z0-9])*|\.))+)/,/^(?:([0-9])+\.([0-9])+\.([0-9])+\.([0-9])+)/,/^(?:eval)/,/^(?:")/,/^(?:(\\"|[^"])*)/,/^(?:")/,/^(?:')/,/^(?:(\\'|[^'])*)/,/^(?:')/,/^(?:(\/|(\.\.?\/)*)(([^ \t\\/?:*><|"'!#;=])+\/?)+\.[a-zA-Z]+)/,/^(?:<\?([ \t])*javascript)/,/^(?:\?>)/,/^(?:(([\x0a\x0d])|\?[^>]|[^?])*)/,/^(?:([-_a-zA-Z0-9?+*])+)/,/^(?:([-_a-zA-Z0-9?+*])*\[([-_a-zA-Z0-9^])+\]([-_a-zA-Z0-9?+*])*)/,/^(?:([-_a-zA-Z0-9?+*])*\{[_a-zA-Z0-9,]+\}([-_a-zA-Z0-9?+*])*)/,/^(?:\()/,/^(?:\))/,/^(?:[^()]*)/,/^(?:expr([ \t])*\()/,/^(?:\/)/,/^(?:\/)/,/^(?:\$?([_a-zA-Z])([_a-zA-Z0-9])*)/,/^(?:([-_a-zA-Z0-9?+*])+)/,/^(?:([-_a-zA-Z0-9?+*])*\[([-_a-zA-Z0-9^])+\]([-_a-zA-Z0-9?+*])*)/,/^(?:([-_a-zA-Z0-9?+*])*\{[_a-zA-Z0-9,]+\}([-_a-zA-Z0-9?+*])*)/,/^(?:([ \t])|([\x0a\x0d]))/,/^(?:=)/,/^(?:;)/,/^(?:\$)/,/^(?::)/,/^(?:,)/,/^(?:\.)/,/^(?:\()/,/^(?:\))/,/^(?:#.*)/,/^(?:!.*)/,/^(?:.|([\x0a\x0d])*)/,/^(?:\(\*)/,/^(?:\*\))/,/^(?:\(\*)/,/^(?:([ \t])+)/,/^(?:([\x0a\x0d]))/,/^(?:$)/,/^(?:.)/,/^(?:.)/],conditions:{OSCSECTION:{rules:[29,30,31,32,33,34],inclusive:!1},EXPRSECTION:{rules:[24,25,26],inclusive:!1},JSECTION:{rules:[19,20],inclusive:!1},COMMENT:{rules:[45,46,47],inclusive:!1},QSTR:{rules:[15,16],inclusive:!1},DQSTR:{rules:[12,13],inclusive:!1},INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,14,17,18,21,22,23,27,28,35,36,37,38,39,40,41,42,43,44,48,49,50,51,52,53],inclusive:!0}}};return t}();return D.lexer=F,f.prototype=D,D.Parser=f,new f}();"undefined"!=typeof require&&"undefined"!=typeof exports&&(exports.parser=INScoreParser,exports.Parser=INScoreParser.Parser,exports.parse=function(){return INScoreParser.parse.apply(INScoreParser,arguments)},exports.main=function(t){t[1]||(console.log("Usage: "+t[0]+" FILE"),process.exit(1));var e=require("fs").readFileSync(require("path").normalize(t[1]),"utf8");return exports.parser.parse(e)},"undefined"!=typeof module&&require.main===module&&exports.main(process.argv.slice(1)));